
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Nock for Everyday Coders &#8212; Nock</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=301bb366" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=df42334f"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/examples/timluc-miptev--nock-for-everyday-coders';</script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Nock - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Nock - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../specification/index.html">The Specification</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../specification/basic-opcodes.html">Basic Opcodes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-0.html">Opcode 0: Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-1.html">Opcode 1: Constant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-2.html">Opcode 2: Evaluate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-3.html">Opcode 3: Cell Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-4.html">Opcode 4: Increment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-5.html">Opcode 5: Equality Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-10.html">Opcode 10: Edit</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../specification/composite-opcodes.html">Composite Opcodes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-6.html">Opcode 6: Conditional</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-7.html">Opcode 7: Compose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-8.html">Opcode 8: Extend</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-9.html">Opcode 9: Invoke</a></li>
<li class="toctree-l3"><a class="reference internal" href="../specification/opcode-11.html">Opcode 11: Hint</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../specification/detailed-examples.html">Examples</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../understanding/index.html">Understanding Nock</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../understanding/combinator-approach.html">The Combinator Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/lambda-approach.html">The Lambda Calculus Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding/assembly-language-approach.html">The Assembly Language Approach</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index.html">Code Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="nouns-and-data.html">Nouns &amp; Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="combinators.html">Combinators</a></li>
<li class="toctree-l2"><a class="reference internal" href="idioms-gates-patterns.html">Idioms, Gates, &amp; Design Patterns</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../compiling/index.html">Languages</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../compiling/relationship-to-hoon.html">Relationship to Hoon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compiling/relationship-to-jock.html">Relationship to Jock</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../hints-jetting/index.html">Hints &amp; Jetting</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../hints-jetting/algorithmic-considerations.html">Algorithmic Considerations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../history/index.html">History</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference external" href="https://urbitsystems.tech/article/v02-i01/a-documentary-history-of-the-nock-combinator-calculus">History of Nock</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-4k.html">Nock 4K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-5k.html">Nock 5K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-6k.html">Nock 6K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-7k.html">Nock 7K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-8k.html">Nock 8K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-9k.html">Nock 9K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-10k.html">Nock 10K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-11k.html">Nock 11K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-12k.html">Nock 12K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/nock-13k.html">Nock 13K</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history/u-model.html">U: A Small Model</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Urbit-Systems-Technical-Journal/nocksite/master?urlpath=tree/content/examples/timluc-miptev--nock-for-everyday-coders.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/Urbit-Systems-Technical-Journal/nocksite" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/examples/timluc-miptev--nock-for-everyday-coders.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Nock for Everyday Coders</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tim-galebach-timluc-miptev-hyperware">Tim Galebach ~timluc-miptev / Hyperware</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contents">Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">1  Getting Started</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phases-of-nock">1.1  Phases of Nock</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-nock-interpreter">1.2  What Is a Nock Interpreter?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-run-nock-code">1.3  How to Run Nock Code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subject-formula">1.4  Subject, Formula?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamental-opcodes">2  Fundamental Opcodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nocks-simplest-functions-0-and-1">2.1  Nock’s Simplest Functions, <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-tree-addressing">2.2  Binary Tree Addressing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-memory-slot">2.3  <code class="docutils literal notranslate"><span class="pre">0</span></code>, the “Memory Slot”</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-retrieve-the-subject">2.3.1  Example: Retrieve the Subject</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-retrieve-the-head-of-the-subject">2.3.2  Example: Retrieve the Head of the Subject</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-crash">2.3.3  Example: A Crash</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-0">2.3.4  Summary of <code class="docutils literal notranslate"><span class="pre">0</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-quoter-function">2.4  <code class="docutils literal notranslate"><span class="pre">1</span></code>, the “Quoter” Function</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-1">2.4.1  Summary of <code class="docutils literal notranslate"><span class="pre">1</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-incrementing-function">2.5  <code class="docutils literal notranslate"><span class="pre">4</span></code>, the Incrementing Function</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-walking-through-increment">2.5.1  Example: Walking Through Increment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.5.2  Example: Walking Through Increment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-walking-through-serial-increment">2.5.3  Example: Walking Through Serial Increment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-walking-through-incrementing-a-constant">2.5.4  Example: Walking Through Incrementing a Constant</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-crash-when-incrementing-a-cell">2.5.5  Example: A Crash When Incrementing a Cell</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-4">2.5.6  Summary of <code class="docutils literal notranslate"><span class="pre">4</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cell-maker-aka-the-distribution-rule">2.6  The Cell-Maker (aka the Distribution Rule)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-detour-into-nock-formulas">2.6.1  A Quick Detour into Nock Formulas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cell-detector-and-5-the-equality-tester">2.7  <code class="docutils literal notranslate"><span class="pre">3</span></code>, the Cell Detector, and <code class="docutils literal notranslate"><span class="pre">5</span></code>, the Equality Tester</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-not-a-cell">2.7.1  Example: Not a Cell</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-cell">2.7.2  Example: A Cell</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-nested-cell-evaluation-with-4">2.7.3  Example: Nested Cell Evaluation with <code class="docutils literal notranslate"><span class="pre">4</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-check-multiple-cases-of-cells">2.7.4  Example: Check Multiple Cases of Cells</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-equality-test">2.7.5  Example: Equality Test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-comparing-two-unequal-values">2.7.6  Example: Comparing Two Unequal Values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-compare-values-with-function-calls">2.7.7  Example: Compare Values with Function Calls</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-compare-cells-with-function-calls">2.7.8  Example: Compare Cells with Function Calls</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-3-and-5">2.7.9  Summary of <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-subject-altering-function">2.8  <code class="docutils literal notranslate"><span class="pre">2</span></code>, the “Subject-Altering” Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subject-altering-to-the-rescue">2.8.1  Subject Altering to the Rescue</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-change-the-subject-and-call-a-constant-value">2.8.2  Example: Change the Subject and Call a Constant Value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-grab-a-block-of-code-from-the-subject-and-run-it">2.8.3  Example: Grab a Block of Code from the Subject and Run It</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-back-to-our-motivating-case">2.8.4  Example: Back to Our Motivating Case</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-2">2.8.5  Summary of <code class="docutils literal notranslate"><span class="pre">2</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-fundamental-opcodes">2.9  Summary of Fundamental Opcodes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#composite-opcodes">3  Composite Opcodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-aside-about-the-1-quoter-function">3.1  An Aside About the <code class="docutils literal notranslate"><span class="pre">1</span></code> (Quoter Function)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-incrementing-a-constant">3.1.1  Example: Incrementing a Constant</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-comparing-a-memory-slot-to-a-constant-value">3.1.2  Example: Comparing a Memory Slot to a Constant Value</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-else-conditional-branch">3.2  <code class="docutils literal notranslate"><span class="pre">6</span></code>, “If/Else” Conditional Branch</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4">3.2.2  Step 4</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3">3.2.3  Step 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2">3.2.4  Step 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">3.2.5  Step 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-code-expansion-of-6">3.2.6  Example: Code Expansion of <code class="docutils literal notranslate"><span class="pre">6</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-6">3.2.7  Summary of <code class="docutils literal notranslate"><span class="pre">6</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-composition-opcode">3.3  <code class="docutils literal notranslate"><span class="pre">7</span></code>, the “Composition” Opcode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-opcode-2-vs-opcode-7">3.3.1  Example: Opcode <code class="docutils literal notranslate"><span class="pre">2</span></code> vs. Opcode <code class="docutils literal notranslate"><span class="pre">7</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-variable-push-opcode">3.4  <code class="docutils literal notranslate"><span class="pre">8</span></code>, the “Variable Push” Opcode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-add-variable-as-a-copied-value-from-an-existing-subject">3.4.1  Example: Add Variable as a Copied Value from an Existing Subject</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-add-variable-as-a-new-value">3.4.2  Example: Add Variable as a New Value</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-a-stored-procedure-arm-in-a-core">3.5  <code class="docutils literal notranslate"><span class="pre">9</span></code>, Run a Stored Procedure Arm in a Core</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-using-9-to-run-an-increment-arm">3.5.1  Example: Using <code class="docutils literal notranslate"><span class="pre">9</span></code> to Run an Increment Arm</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#key-point-possible-confusion">3.5.2  Key Point/Possible Confusion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-think-of-9">3.5.3  How to Think of <code class="docutils literal notranslate"><span class="pre">9</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replace-a-memory-slot">3.6  <code class="docutils literal notranslate"><span class="pre">10</span></code>, Replace a Memory Slot</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-using-10-to-replace-a-memory-slot">3.6.1  Example: Using <code class="docutils literal notranslate"><span class="pre">10</span></code> to Replace a Memory Slot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#towards-hoon">3.6.2  Towards Hoon</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-nock-code">3.7  Real Nock Code</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-loobean-mold">3.7.1  Example: A Loobean Mold</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">3.8  Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interlude">4  Interlude</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#order-of-operations">4.1  Order of Operations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-nock-order-of-operations">4.1.1  Summary of Nock Order of Operations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hints-and-side-effects-for-the-interpreter">4.2  <code class="docutils literal notranslate"><span class="pre">11</span></code>, Hints and Side Eﬀects for the Interpreter</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-interpreter-processes-a-message">4.2.1  Option #1: Interpreter Processes a Message</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-run-nock-code-and-then-process-a-message">4.2.2  Option #2: Run Nock Code and then Process a Message</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-use-of-11-jet-registration">4.2.3  Practical Use of <code class="docutils literal notranslate"><span class="pre">11</span></code>: Jet Registration</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nock-in-hoon">4.3  Nock in Hoon</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-core-as-design-pattern">5  The Core as Design Pattern</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-core-manually">5.1  Building a Core Manually</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-simple-increment-gate">5.1.1  Example: A Simple Increment Gate</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">5.1.2  Summary</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-decrement-gate">5.1.3  Example: A Decrement Gate</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-comparing-two-numbers">5.1.4  Example: Comparing Two Numbers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">6  Conclusion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nock-for-everyday-coders">
<h1>Nock for Everyday Coders<a class="headerlink" href="#nock-for-everyday-coders" title="Link to this heading">#</a></h1>
<section id="tim-galebach-timluc-miptev-hyperware">
<h2>Tim Galebach ~timluc-miptev / <a class="reference external" href="https://hyperware.ai/">Hyperware</a><a class="headerlink" href="#tim-galebach-timluc-miptev-hyperware" title="Link to this heading">#</a></h2>
</section>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>Nock is not super complex, and most programmers
can learn the basics of it rapidly. The mental model
gained by learning Nock turns out to be very
useful in learning Hoon and understanding Urbit.
While the Urbit docs generally suggest to not
worry about Nock, Nock is very simple and small.
Most programmers will feel more comfortable in
Hoon having learned Nock’s basics. The goal of this
tutorial is to explain Nock clearly in terms most
programmers will relate to, to impart a feeling of
conﬁdence with very basic Nock, and to give a
knowledge of Nock’s idioms and big wins so that
they carry over to learning Hoon.</p>
<p>This tutorial was originally published online
by ~timluc-miptev in early 2020 and remains
an excellent exposition of Nock’s aﬀordances.</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference external" href="https://urbitsystems.tech/article/v02-i01/nock-for-everyday-coders">Publication:  ~timluc-miptev (2025), “Nock for Everyday Coders”, <em>Urbit Systems Technical Journal</em> II:1, pp. 1–45</a></p></li>
</ul>
</section>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1 Getting Started
 1.1 Phases of Nock
 1.2 What Is a Nock Interpreter?
 1.3 How to Run Nock Code
 1.4 Subject, Formula?
 1.5 Evaluating Our First Nock
            Code
 2 Fundamental Opcodes
 2.1 Nock’s Simplest Functions, `0` and `1`
 2.2 Binary Tree Addressing
 2.3 `0`, the “Memory
            Slot” Function
 2.4 `1`, the
            “Quoter” Function
 2.5 `4`, the
            Incrementing Function
 2.6 The Cell-Maker (aka the Distribution Rule)
 2.7 `3`, the Cell
            Detector, and `5`, the
            Equality Tester
 2.8 `2`, the
            “Subject-Altering” Function
 2.9 Summary of Fundamental
            Opcodes
 3 Composite Opcodes
 3.1 An Aside About the `1` (Quoter
            Function)
 3.2 `6`, “If/Else”
            Conditional Branch
 3.3 `7`, the
            “Composition” Opcode
 3.4 `8`, the
            “Variable Push” Opcode
 3.5 `9`, Run a
            Stored Procedure Arm in a Core
 3.6 `10`, Replace a
            Memory Slot
 3.7 Real Nock Code
 3.8 Summary
 4 Interlude
 4.1 Order of Operations
 4.2 `11`, Hints and
            Side Eﬀects for the Interpreter
 4.3 Nock in Hoon
 5 The Core as Design Pattern
 5.1 Building a Core Manually
 6 Conclusion
</pre></div>
</div>
</section>
<section id="getting-started">
<h2>1  Getting Started<a class="headerlink" href="#getting-started" title="Link to this heading">#</a></h2>
<p>When people ﬁrst look at Nock, they see the deﬁnition,
which is fairly intimidating. I’m talking about lines like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="n">b</span><span class="p">]</span>        <span class="o">/</span><span class="p">[</span><span class="mi">2</span> <span class="o">/</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]]</span>
</pre></div>
</div>
<p>The problem is, the programmer may already know that Nock
code looks more like the below – just lists of numbers, with no
symbols:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">6</span> 
 <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]]</span> 
 <span class="p">[</span><span class="mi">0</span> <span class="mi">7</span><span class="p">]</span> 
 <span class="p">[</span><span class="mi">9</span> <span class="mi">4</span> <span class="p">[[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">5</span><span class="p">]]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">7</span><span class="p">]]]</span> 
<span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>What gives? Which one is the “real” Nock?</p>
<section id="phases-of-nock">
<h3>1.1  Phases of Nock<a class="headerlink" href="#phases-of-nock" title="Link to this heading">#</a></h3>
<p>We are looking at two diﬀerent things in the examples
above:</p>
<p>Pseudocode for how to interpret Nock.</p>
<p>Code to be interpreted (written as lists of numbers).</p>
<p>The symbols and spec are pseudocode, not real Nock code.
They could just as easily be written in English, and they will
never be written down as actual Nock code and given to an
interpreter. They represent what an interpreter should do to
turn Nock code into interpreter instructions.</p>
<p>The lists of numbers are the actual Nock code. This is
what you feed to an interpreter to get some result.</p>
</section>
<section id="what-is-a-nock-interpreter">
<h3>1.2  What Is a Nock Interpreter?<a class="headerlink" href="#what-is-a-nock-interpreter" title="Link to this heading">#</a></h3>
<p>An interpreter can be a computer program, or it can be a
human manually expanding Nock code into results. In both
cases, the program and human have to know the Nock
pseudocode in order to do the right thing with incoming Nock
code.</p>
<p>So a Nock interpreter is any entity that takes Nock
code as input, and gives a noun as output. A noun can
be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span> <span class="n">a</span> <span class="n">number</span> 
<span class="mi">782</span> 
<span class="p">::</span> <span class="n">a</span> <span class="n">cell</span> <span class="p">(</span><span class="n">pair</span> <span class="k">with</span> <span class="n">two</span> <span class="n">elements</span><span class="p">)</span> 
<span class="p">[</span><span class="mi">782</span> <span class="mi">9872</span><span class="p">]</span> 
<span class="mi">5</span><span class="p">::</span> <span class="n">each</span> <span class="n">element</span> <span class="n">can</span> <span class="n">itself</span> <span class="n">be</span> <span class="n">a</span> <span class="n">pair</span> 
<span class="p">[</span><span class="mi">782</span> <span class="p">[</span><span class="mi">9872</span> <span class="mi">89728</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">the</span> <span class="n">above</span> <span class="n">can</span> <span class="n">be</span> <span class="n">written</span> <span class="k">as</span> 
<span class="p">[</span><span class="mi">782</span> <span class="mi">9872</span> <span class="mi">89728</span><span class="p">]</span>
</pre></div>
</div>
<blockquote>
<div><p>In this interactive tutorial, we are evaluating code, not raw data like the above, so we won’t take these as input yet.</p>
</div></blockquote>
</section>
<section id="how-to-run-nock-code">
<h3>1.3  How to Run Nock Code<a class="headerlink" href="#how-to-run-nock-code" title="Link to this heading">#</a></h3>
<p>We will be expanding Nock pseudocode manually in the
examples that follow, in eﬀect acting as our own interpreter.</p>
<p>If we want to check that we’re getting the right results
from our manual interpretation, we need to run a Nock
interpreter, such as the Urbit Dojo.</p>
<p>Start up a Dojo session on a fake ship.1</p>
<p>At the prompt, we can execute Nock using .* dottar,
e.g., <code class="docutils literal notranslate"><span class="pre">.*(NOCK_SUBJECT,</span> <span class="pre">NOCK_FORMULA)</span></code>.</p>
</section>
<section id="subject-formula">
<h3>1.4  Subject, Formula?<a class="headerlink" href="#subject-formula" title="Link to this heading">#</a></h3>
<p>Let’s keep this simple:</p>
<p>subject = an argument to a function</p>
<p>formula = the function</p>
<p>That’s it. We’ll see below how this works, going really
slowly with examples.</p>
<p>1.5  Evaluating Our First Nock Code</p>
<p>OK, so the interpreter takes two arguments, a “subject”
and a “formula”. Both are nouns (a number or a cell).
Let’s run some insanely simple Nock code in the
Dojo:</p>
<p>We can run this directly using <code class="docutils literal notranslate"><span class="pre">.*</span></code> dottar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(42 [0 1])
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42
</pre></div>
</div>
</div>
</div>
<p>Or we can run it in two steps (with the subject being “sticky” between calls):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 42
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subject set to: 42
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:formula [0 1]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42
</pre></div>
</div>
</div>
</div>
<p>We don’t even need to specify <code class="docutils literal notranslate"><span class="pre">:formula</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[0 1]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42
</pre></div>
</div>
</div>
</div>
<p>In the above, <code class="docutils literal notranslate"><span class="pre">42</span></code> is our subject.
<code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>
is our formula.</p>
<p>Formulas are always cells, and the ﬁrst element of the cell
is a number that you can think of as the name of the
function.</p>
<p>In this case, our function name is <code class="docutils literal notranslate"><span class="pre">0</span></code>, which is the memory
slot function. It is always followed by 1 number, in this case <code class="docutils literal notranslate"><span class="pre">1</span></code>,
which is the number of the memory slot to fetch in the
subject.</p>
<p>Whenever we look at Nock code, we want to ask:</p>
<p>What is the subject (function argument)? In this
case, it’s <code class="docutils literal notranslate"><span class="pre">42</span></code>.</p>
<p>What is the formula (function)? In this case, it’s
<code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>.</p>
<p>What value does that formula (function) produce
when called on this subject (argument)? In this case,
the return value is <code class="docutils literal notranslate"><span class="pre">42</span></code>.</p>
<p>Why is the return value <code class="docutils literal notranslate"><span class="pre">42</span></code>? How
does this formula
work?</p>
</section>
</section>
<section id="fundamental-opcodes">
<h2>2  Fundamental Opcodes<a class="headerlink" href="#fundamental-opcodes" title="Link to this heading">#</a></h2>
<section id="nocks-simplest-functions-0-and-1">
<h3>2.1  Nock’s Simplest Functions, <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code><a class="headerlink" href="#nocks-simplest-functions-0-and-1" title="Link to this heading">#</a></h3>
<p>The two most basic Nock functions are <code class="docutils literal notranslate"><span class="pre">0</span></code> address and <code class="docutils literal notranslate"><span class="pre">1</span></code>
constant. The goal here is to get strong intuitions of what they
do, how they handle edge cases, and how this relates to the
Nock spec/pseudocode.</p>
</section>
<section id="binary-tree-addressing">
<h3>2.2  Binary Tree Addressing<a class="headerlink" href="#binary-tree-addressing" title="Link to this heading">#</a></h3>
<p>Before getting started on Nock proper, we should
understand how Nock and Hoon handle addresses in binary
trees. If you already understand why memory slot 5 of
<code class="docutils literal notranslate"><span class="pre">[['apple'</span> <span class="pre">%pie]</span> <span class="pre">[0b1101</span> <span class="pre">0xdad]]</span></code>
is <code class="docutils literal notranslate"><span class="pre">%pie</span></code>, you are
good to go and can skip ahead to Section 2.3.</p>
<p>Every noun in Nock can be thought of as a tree, which
means we can give an exact number to access any position in
the tree. This means that, no matter how big our subject
(argument) is, we can yank a value out of any part of
it.</p>
<p>The Nock speciﬁcation deﬁnes noun tree addressing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="p">[</span><span class="mi">1</span> <span class="n">a</span><span class="p">]</span>              <span class="n">a</span> 
<span class="o">/</span><span class="p">[</span><span class="mi">2</span> <span class="n">a</span> <span class="n">b</span><span class="p">]</span>            <span class="n">a</span> 
<span class="o">/</span><span class="p">[</span><span class="mi">3</span> <span class="n">a</span> <span class="n">b</span><span class="p">]</span>            <span class="n">b</span> 
<span class="o">/</span><span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="n">b</span><span class="p">]</span>        <span class="o">/</span><span class="p">[</span><span class="mi">2</span> <span class="o">/</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]]</span> 
<span class="mi">5</span><span class="o">/</span><span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="n">b</span><span class="p">]</span>    <span class="o">/</span><span class="p">[</span><span class="mi">3</span> <span class="o">/</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]]</span>
</pre></div>
</div>
<p>This permits the address to be deﬁned within a particular
subtree as well as within the overall tree (Figure 1).</p>
<p><img alt="" src="https://urbitsystems.tech/ustj/v02-i01/img/mss0x.png" /></p>
<p><strong>Figure 1</strong>: A binary tree with labeled
node addresses to
several layers.</p>
<p>That is, how do you say which slot number you want from
a given tree? We say that:</p>
<p>The tree root is address <span class="math notranslate nohighlight">\(1\)</span>.</p>
<p>The head of every node <span class="math notranslate nohighlight">\((n)\)</span> is <span class="math notranslate nohighlight">\((2n)\)</span>.</p>
<p>The tail of every node <span class="math notranslate nohighlight">\((n)\)</span> is <span class="math notranslate nohighlight">\((2n+1)\)</span>.</p>
<p>Let’s take an example tree to illustrate. In Nock cell form,
the tree is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mi">4</span> <span class="mi">5</span><span class="p">]</span> <span class="p">[</span><span class="mi">6</span> <span class="mi">14</span> <span class="mi">15</span><span class="p">]]</span>
</pre></div>
</div>
<p>Diagrammatically, the tree looks like Figure 2.</p>
<p><img alt="" src="https://urbitsystems.tech/ustj/v02-i01/img/mss1x.png" /></p>
<p><strong>Figure 2</strong>: A binary tree with some
labeled node addresses.</p>
<p>1 is the address of the whole tree,
<code class="docutils literal notranslate"><span class="pre">[[4</span> <span class="pre">5]</span> <span class="pre">[6</span> <span class="pre">14</span> <span class="pre">15]]</span></code>.</p>
<p>2 is the address of the left branch, <code class="docutils literal notranslate"><span class="pre">[4</span> <span class="pre">5]</span></code>.</p>
<p>3 is the address of the right branch, <code class="docutils literal notranslate"><span class="pre">[6</span> <span class="pre">14</span> <span class="pre">15]</span></code>.</p>
<p>15 is the value <code class="docutils literal notranslate"><span class="pre">15</span></code>.</p>
<p>Let’s play around now in the Dojo Nock interpreter so that
we can conﬁrm this. In each example, our subject (argument)
will be the tree <code class="docutils literal notranslate"><span class="pre">[[4</span> <span class="pre">5]</span> <span class="pre">[6</span> <span class="pre">14</span> <span class="pre">15]]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [[4 5] [6 14 15]]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subject set to: [[4 5] 6 14 15]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">2]</span></code>: get the left branch</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[0 2]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4 5]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">7]</span></code>: get the subtree in slot 7</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[0 7]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[14 15]
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-memory-slot">
<h3>2.3  <code class="docutils literal notranslate"><span class="pre">0</span></code>, the “Memory Slot”<a class="headerlink" href="#the-memory-slot" title="Link to this heading">#</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Function
</pre></div>
</div>
<p>The pseudocode for the <code class="docutils literal notranslate"><span class="pre">0</span></code>
opcode
is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">0</span> <span class="n">b</span><span class="p">]</span>    <span class="o">/</span><span class="p">[</span><span class="n">b</span> <span class="n">a</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/[b</span> <span class="pre">a]</span></code>
is pseudocode. In English, it means “<code class="docutils literal notranslate"><span class="pre">a</span></code> is a
binary
tree. Get the memory slot numbered <code class="docutils literal notranslate"><span class="pre">b</span></code>.”</p>
<p>So if <code class="docutils literal notranslate"><span class="pre">a</span></code> were the tree <code class="docutils literal notranslate"><span class="pre">[9</span> <span class="pre">10]</span></code>,
and <code class="docutils literal notranslate"><span class="pre">b</span></code> were <code class="docutils literal notranslate"><span class="pre">1</span></code>, we’d get the
memory slot <code class="docutils literal notranslate"><span class="pre">1</span></code> in the tree <code class="docutils literal notranslate"><span class="pre">[9</span> <span class="pre">10]</span></code>,
which is just the tree
itself.</p>
<p>Written in pseudocode, that’s <code class="docutils literal notranslate"><span class="pre">/[1</span> <span class="pre">[9</span> <span class="pre">10]]</span></code>.
We can
also do <code class="docutils literal notranslate"><span class="pre">/[2</span> <span class="pre">[9</span> <span class="pre">10]]</span></code>,
which grabs memory slot <code class="docutils literal notranslate"><span class="pre">2</span></code>, aka
<code class="docutils literal notranslate"><span class="pre">9</span></code>.</p>
<p>Let’s look at some examples. I’ve put them ﬁrst in Dojo
form so that you can see how they run in that interpreter, and
then I show the “human interpreter” in pseudocode below
that.</p>
<section id="example-retrieve-the-subject">
<h4>2.3.1  Example: Retrieve the Subject<a class="headerlink" href="#example-retrieve-the-subject" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subject set to: [50 51]
</pre></div>
</div>
</div>
</div>
<p>Get memory slot 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[0 1]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[50 51]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> 
<span class="p">::</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">0</span> <span class="n">b</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span> 
<span class="o">/</span><span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]]</span> 
<span class="p">[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="example-retrieve-the-head-of-the-subject">
<h4>2.3.2  Example: Retrieve the Head of the Subject<a class="headerlink" href="#example-retrieve-the-head-of-the-subject" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subject set to: [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[0 2]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="mi">5</span><span class="p">::</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">0</span> <span class="n">b</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> 
<span class="o">/</span><span class="p">[</span><span class="mi">2</span> <span class="p">[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]]</span> 
<span class="mi">50</span>
</pre></div>
</div>
</section>
<section id="example-a-crash">
<h4>2.3.3  Example: A Crash<a class="headerlink" href="#example-a-crash" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Subject set to: [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[0 [0 1]]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error: fas: first argument must be atom
Traceback (most recent call last):
  File &quot;/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/nock_kernel/kernel.py&quot;, line 202, in do_execute
    result = nock(self.subject, formula)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pinochle/nock.py&quot;, line 152, in nock
    return fas(b, a)
           ^^^^^^^^^
  File &quot;/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pinochle/nock.py&quot;, line 89, in fas
    raise Exception(&quot;fas: first argument must be atom&quot;)
Exception: fas: first argument must be atom
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]]</span> 
<span class="mi">5</span><span class="o">/</span><span class="p">[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">can</span><span class="s1">&#39;t evaluate this--a memory slot must be a number like 2, not a cell like [0 1] </span>
<span class="n">CRASH</span>
</pre></div>
</div>
</section>
<section id="summary-of-0">
<h4>2.3.4  Summary of <code class="docutils literal notranslate"><span class="pre">0</span></code><a class="headerlink" href="#summary-of-0" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code> is everywhere in
Nock, because “get something from a
memory slot” really means “store stuﬀ in a place and get it
whenever I want,” which is another name for creating
variables. These memory slot numbers take the place of
variable names.</p>
<p>If you’re familiar with assembly or C, they’re conceptually
similar to memory pointers or registers in how Nock uses
them. Keep in mind though, Nock is functional/immutable, so
it doesn’t update memory locations: it creates copies of data
structures with altered values.</p>
<p>We’ve also seen that the memory slot function can’t take
just anything as the memory slot to fetch: it must receive an
atom (number).</p>
</section>
</section>
<section id="the-quoter-function">
<h3>2.4  <code class="docutils literal notranslate"><span class="pre">1</span></code>, the “Quoter” Function<a class="headerlink" href="#the-quoter-function" title="Link to this heading">#</a></h3>
<p>This is another really simple function. You can think of it as a
“quoter”: it just returns any value passed to it exactly as it is.
It ignores the subject, and just quotes the value after it. Let’s
look at a couple examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([20 30] [1 67]) 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([20 30] [1 [2 [587]]])
</pre></div>
</div>
</div>
</div>
<p>It doesn’t matter how much information is after the <code class="docutils literal notranslate"><span class="pre">1</span></code>: <code class="docutils literal notranslate"><span class="pre">1</span></code> is
a dumb function that just returns it all.</p>
<p>The pseudocode for <code class="docutils literal notranslate"><span class="pre">1</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">1</span> <span class="n">b</span><span class="p">]</span>    <span class="n">b</span>
</pre></div>
</div>
<p>In English, this means: “ignore the subject <code class="docutils literal notranslate"><span class="pre">a</span></code>, and just
return everything after the <code class="docutils literal notranslate"><span class="pre">1</span></code> exactly as it is.</p>
<p>Let’s look at our ﬁrst example, <code class="docutils literal notranslate"><span class="pre">.*([20</span> <span class="pre">30]</span> <span class="pre">[1</span> <span class="pre">67])</span></code>.
The subject <code class="docutils literal notranslate"><span class="pre">a</span></code> is <code class="docutils literal notranslate"><span class="pre">[20</span> <span class="pre">30]</span></code>,
so we ignore that. What’s after the
<code class="docutils literal notranslate"><span class="pre">1</span></code>? <code class="docutils literal notranslate"><span class="pre">67</span></code>, so we return that.</p>
<p>In the second example, “everything after the <code class="docutils literal notranslate"><span class="pre">1</span></code>” is
longer, but the same rule applies: the Nock interpreter just
returns it exactly as it is, after stripping out unnecessary
brackets.</p>
<section id="summary-of-1">
<h4>2.4.1  Summary of <code class="docutils literal notranslate"><span class="pre">1</span></code><a class="headerlink" href="#summary-of-1" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code> is a simple
function that just returns whatever is after it
(“quoter” or “constant”). It’s useful for quoting values that
you want to use later in your Nock code.</p>
</section>
</section>
</section>
<section id="the-incrementing-function">
<h2>2.5  <code class="docutils literal notranslate"><span class="pre">4</span></code>, the Incrementing Function<a class="headerlink" href="#the-incrementing-function" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code> are simple
functions that don’t have any nested
behavior. Now we’re going to move to a function that
does have nested children, opcode <code class="docutils literal notranslate"><span class="pre">4</span></code>. In these
examples,
pay attention to how <code class="docutils literal notranslate"><span class="pre">4</span></code> operates on its
arguments; we’ll
look at pseudocode and break down the examples in a
moment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 0 1]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 4 0 1]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [100 150]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 4 0 3]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 1 98]
</pre></div>
</div>
</div>
</div>
<p>Expect failure here, because you cannot increment a cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 1 [0 2]]
</pre></div>
</div>
</div>
</div>
<p>Here’s <code class="docutils literal notranslate"><span class="pre">4</span></code>’s pseudocode,
juxtaposed with that of <code class="docutils literal notranslate"><span class="pre">0</span></code> and
<code class="docutils literal notranslate"><span class="pre">1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">4</span> <span class="n">b</span><span class="p">]</span>  <span class="o">+*</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]</span> 
<span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">0</span> <span class="n">b</span><span class="p">]</span>  <span class="o">/</span><span class="p">[</span><span class="n">b</span> <span class="n">a</span><span class="p">]</span> 
<span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">1</span> <span class="n">b</span><span class="p">]</span>  <span class="n">b</span>
</pre></div>
</div>
<p>In English, this says “when we have subject <code class="docutils literal notranslate"><span class="pre">a</span></code>,
function <code class="docutils literal notranslate"><span class="pre">4</span></code>, and
Nock code <code class="docutils literal notranslate"><span class="pre">b</span></code>, ﬁrst evaluate <code class="docutils literal notranslate"><span class="pre">[a</span> <span class="pre">b]</span></code>
as
<code class="docutils literal notranslate"><span class="pre">[subject</span> <span class="pre">formula]</span></code>,
and then add 1 to the result.”</p>
<p>If we contrast with <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>, we see that the
right side has
a <code class="docutils literal notranslate"><span class="pre">*</span></code> symbol. This symbol means “evaluate the
expression
again in the Nock interpreter.” <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code> did not have this
symbol, and that’s why they couldn’t evaluate nested Nock
expressions.</p>
<section id="example-walking-through-increment">
<h3>2.5.1  Example: Walking Through Increment<a class="headerlink" href="#example-walking-through-increment" title="Link to this heading">#</a></h3>
<p>Let’s start by translating the Dojo’s <code class="docutils literal notranslate"><span class="pre">.*(subject</span> <span class="pre">formula)</span></code>
to pseudocode of the form <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>,
and then expand it line by
line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 0 1]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">move</span> <span class="n">the</span> <span class="mi">4</span> <span class="n">to</span> <span class="n">the</span> <span class="n">outside</span> <span class="k">as</span> <span class="o">+</span> 
<span class="o">+*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">expand</span> <span class="n">the</span> <span class="mi">0</span> <span class="n">opcode</span> <span class="n">to</span> <span class="n">the</span> <span class="n">memory</span> <span class="n">slot</span> <span class="n">operator</span> <span class="s2">&quot;/&quot;</span> 
<span class="o">+/</span><span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">grabs</span> <span class="n">the</span> <span class="n">memory</span> <span class="n">slot</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> 
<span class="p">::</span> <span class="n">evaluate</span> 
<span class="mi">51</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">[a</span> <span class="pre">b]</span></code>
part of <code class="docutils literal notranslate"><span class="pre">+*[a</span> <span class="pre">b]</span></code>
expands to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
<p>OK, this we know how to handle! It’s just our <code class="docutils literal notranslate"><span class="pre">0</span></code> function, and
it wants the value in memory slot <code class="docutils literal notranslate"><span class="pre">1</span></code> of the
subject. That’s
<code class="docutils literal notranslate"><span class="pre">50</span></code>.</p>
<p>Now we know that <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]=50</span></code>,
and we just have to add 1
to it (the <code class="docutils literal notranslate"><span class="pre">+</span></code> in <code class="docutils literal notranslate"><span class="pre">+*[a</span> <span class="pre">b]</span></code>).
That is <code class="docutils literal notranslate"><span class="pre">51</span></code>, which is exactly what
the interpreter gave us.</p>
</section>
<section id="id1">
<h3>2.5.2  Example: Walking Through Increment<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>This one is similar, we just have an extra <code class="docutils literal notranslate"><span class="pre">4</span></code>. We again start
by translating the Dojo’s <code class="docutils literal notranslate"><span class="pre">.*(subject</span> <span class="pre">formula)</span></code>
to
pseudocode, and then expand</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 4 0 1]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[50 [4 4 0 1]] 
:: the first 4 moves outside as a &#39;+&#39; 
+*[50 [4 0 1]] 
:: 2nd 4 becomes a &#39;+&#39;...we have opcode 0 again! 
++*[50 [0 1]] 
++/[1 50] 
++(50) 
+(51) 
52
</pre></div>
</div>
</section>
<section id="example-walking-through-serial-increment">
<h3>2.5.3  Example: Walking Through Serial Increment<a class="headerlink" href="#example-walking-through-serial-increment" title="Link to this heading">#</a></h3>
<p>Here we again see lots of <code class="docutils literal notranslate"><span class="pre">4</span></code>s applied
consecutively, and we also
see how we can yank values out of a more complicated subject
and manipulate them. Notice how the subject is a cell,
not an atom. The rest is the same as in the previous
example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [100 150]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 4 0 3]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="p">(</span><span class="n">the</span> <span class="n">subject</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span> <span class="mi">150</span><span class="p">]</span> 
<span class="o">*</span><span class="p">[[</span><span class="mi">100</span> <span class="mi">150</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]]</span> 
<span class="o">+*</span><span class="p">[[</span><span class="mi">100</span> <span class="mi">150</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">Now</span> <span class="n">we</span><span class="s1">&#39;ve extracted all the increments, </span>
<span class="p">::</span> <span class="n">so</span> <span class="n">we</span> <span class="n">just</span> <span class="n">grab</span> <span class="n">the</span> <span class="n">value</span> <span class="n">at</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">3</span> 
<span class="o">++*</span><span class="p">[[</span><span class="mi">100</span> <span class="mi">150</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]</span> 
<span class="o">++/</span><span class="p">[</span><span class="mi">3</span> <span class="p">[</span><span class="mi">100</span> <span class="mi">150</span><span class="p">]]</span> 
<span class="o">++</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">151</span><span class="p">)</span> 
<span class="mi">152</span>
</pre></div>
</div>
</section>
<section id="example-walking-through-incrementing-a-constant">
<h3>2.5.4  Example: Walking Through Incrementing a Constant<a class="headerlink" href="#example-walking-through-incrementing-a-constant" title="Link to this heading">#</a></h3>
<p>In the below example, we see how we can use the quote/constant
function <code class="docutils literal notranslate"><span class="pre">1</span></code> to
generate the value <code class="docutils literal notranslate"><span class="pre">98</span></code> and increment it. We
ignore the subject <code class="docutils literal notranslate"><span class="pre">50</span></code> completely.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 1 98]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">1</span> <span class="mi">98</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">formula</span> <span class="ow">is</span> <span class="n">the</span> <span class="s2">&quot;quoter&quot;</span> <span class="n">function</span> 
<span class="o">+*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">98</span><span class="p">]]</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">98</span><span class="p">)</span> 
<span class="mi">99</span>
</pre></div>
</div>
</section>
<section id="example-a-crash-when-incrementing-a-cell">
<h3>2.5.5  Example: A Crash When Incrementing a Cell<a class="headerlink" href="#example-a-crash-when-incrementing-a-cell" title="Link to this heading">#</a></h3>
<p>Just as opcode <code class="docutils literal notranslate"><span class="pre">0</span></code> had values it
couldn’t handle (non-atoms), so
opcode <code class="docutils literal notranslate"><span class="pre">4</span></code> needs
the nested value inside it to evaluate to an
atom.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 1 [0 2]]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">1</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">OK</span> <span class="n">cool</span><span class="p">,</span> <span class="n">the</span> <span class="n">nested</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">a</span> <span class="mi">1</span> <span class="n">opcode</span> 
<span class="o">+*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="mi">1</span> <span class="n">ignores</span> <span class="n">the</span> <span class="n">subject</span> <span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="n">just</span> <span class="n">returns</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> 
<span class="o">+</span><span class="p">([</span><span class="mi">0</span> <span class="mi">2</span><span class="p">])</span> 
<span class="p">::</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="n">isn</span><span class="s1">&#39;t an atom, so how can we increment it??? </span>
<span class="p">::</span> <span class="n">We</span> <span class="n">can</span><span class="s1">&#39;t, so we crash. </span>
<span class="n">CRASH</span>
</pre></div>
</div>
</section>
<section id="summary-of-4">
<h3>2.5.6  Summary of <code class="docutils literal notranslate"><span class="pre">4</span></code><a class="headerlink" href="#summary-of-4" title="Link to this heading">#</a></h3>
<p>In these examples, we’ve seen that function <code class="docutils literal notranslate"><span class="pre">4</span></code> can be called as
many times in a row as we want. At the end of those calls, it
always ends up incrementing a number that either is yanked
from the subject (memory slot function <code class="docutils literal notranslate"><span class="pre">0</span></code>) or quoted as it
is
(quote function <code class="docutils literal notranslate"><span class="pre">1</span></code>).</p>
</section>
<section id="the-cell-maker-aka-the-distribution-rule">
<h3>2.6  The Cell-Maker (aka the Distribution Rule)<a class="headerlink" href="#the-cell-maker-aka-the-distribution-rule" title="Link to this heading">#</a></h3>
<p>The Nock interpreter is allowed to return nouns, which are
atoms (positive numbers) or cells (pairs of nouns). What have
our functions/opcodes been returning so far?</p>
<p><code class="docutils literal notranslate"><span class="pre">0</span></code>: atoms or
cells, depending what’s in the memory
slot that we yoink.</p>
<p><code class="docutils literal notranslate"><span class="pre">1</span></code>: atoms or
cells, depending on what we quote.</p>
<p><code class="docutils literal notranslate"><span class="pre">4</span></code>: just atoms.</p>
<p>But what if my subject was <code class="docutils literal notranslate"><span class="pre">[51</span> <span class="pre">67</span> <span class="pre">89]</span></code>,
and I wanted to
increment every value and return that as <code class="docutils literal notranslate"><span class="pre">[52</span> <span class="pre">68</span> <span class="pre">90]</span></code>?
How
can I do that when it’s a cell, and <code class="docutils literal notranslate"><span class="pre">4</span></code> only seems able to
return
atoms?</p>
<p>The answer is something that the Nock docs call the
“distribution rule” or “implicit cons” (hello, fellow lispers!),
but that I ﬁnd easiest to think of as the “Cell-Maker
Rule”.</p>
<section id="a-quick-detour-into-nock-formulas">
<h4>2.6.1  A Quick Detour into Nock Formulas<a class="headerlink" href="#a-quick-detour-into-nock-formulas" title="Link to this heading">#</a></h4>
<p>We haven’t talked much yet about what values are legal to
feed into the Nock interpreter (the <code class="docutils literal notranslate"><span class="pre">.*(subject</span> <span class="pre">formula)</span></code>
function in the Dojo). So far, we’ve only been using formulas
that start with numbers (our functions/opcodes <code class="docutils literal notranslate"><span class="pre">0</span></code>/<code class="docutils literal notranslate"><span class="pre">1</span></code>/<code class="docutils literal notranslate"><span class="pre">4</span></code>).</p>
<p>Let’s now fully solidify our understanding of what’s a legal
formula by taking a quick look at the three possible cases.
(The format is<code class="docutils literal notranslate"><span class="pre">.*(subject</span> <span class="pre">formula)</span></code>.)</p>
<p>The formula is a cell starting with an opcode. We
know this is OK.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(50 [0 1])
</pre></div>
</div>
</div>
</div>
<p>The formula is just an atom (0). This is not valid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(50 0)
</pre></div>
</div>
</div>
</div>
<p>Finally, we try a formula that is a cell starting with an
atom. This looks invalid, but—it works!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(50 [[0 1] [1 203]])
</pre></div>
</div>
</div>
</div>
<p>So apparently a formula cell can start with a cell. The
Cell-Maker rule is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[subject [formula-x formula-y]]→ 
  [*[subject formula-x] *[subject formula-y]]
</pre></div>
</div>
<p>In our example above, <code class="docutils literal notranslate"><span class="pre">formula-x</span></code>
is <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>,
and
<code class="docutils literal notranslate"><span class="pre">formula-y</span></code> is <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">203]</span></code>.
They each evaluate individually
against the subject, and the end result is a cell.</p>
<p>We can make as many cells in a row as we want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(50 [[0 1] [1 203] [0 1] [1 19] [1 76]]) 
</pre></div>
</div>
</div>
</div>
<p>We can put any operation inside each cell:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([19 20] [[0 1] [1 76] [4 4 0 3]]) 
</pre></div>
</div>
</div>
</div>
<p>If we take the returned collection <code class="docutils literal notranslate"><span class="pre">[[19</span> <span class="pre">20]</span> <span class="pre">76</span> <span class="pre">22]</span></code>
in
order, we can write in English how they connect to our
collection of formulas that we passed:</p>
<p><code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>:
get memory slot 1</p>
<p><code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">76]</span></code>:
return the quoted value <code class="docutils literal notranslate"><span class="pre">76</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">[4</span> <span class="pre">4</span> <span class="pre">0</span> <span class="pre">3]</span></code>:
increment twice the value in memory
slot 3 (<code class="docutils literal notranslate"><span class="pre">20</span></code>)</p>
<p>So we can pass one small subject (<code class="docutils literal notranslate"><span class="pre">[19</span> <span class="pre">20]</span></code>)
and make an
arbitrarily long collection of values from it, using any
functions we want. Cell-Maker ftw!</p>
</section>
</section>
<section id="the-cell-detector-and-5-the-equality-tester">
<h3>2.7  <code class="docutils literal notranslate"><span class="pre">3</span></code>, the Cell Detector, and <code class="docutils literal notranslate"><span class="pre">5</span></code>, the Equality Tester<a class="headerlink" href="#the-cell-detector-and-5-the-equality-tester" title="Link to this heading">#</a></h3>
<p>Now we come to functions/opcodes <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code>, which are pretty
straightforward after we’ve seen how <code class="docutils literal notranslate"><span class="pre">4</span></code> and the Cell-Maker
work. Functions <code class="docutils literal notranslate"><span class="pre">3</span></code>
and <code class="docutils literal notranslate"><span class="pre">5</span></code>, like <code class="docutils literal notranslate"><span class="pre">4</span></code>, allow nested
evaluation.
Let’s put all their pseudocode deﬁnitions together to
compare:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>::  function/opcode 3 
*[a 3 b]    ?*[a b] 
:: function/opcode 4 
*[a 4 b]    +*[a b] 
5:: function/opcode 5 
*[a 5 b c]  =[*[a b] *[a c]]
</pre></div>
</div>
<p>First of all, notice how the right side of all these “equations”
has the evaluation operator, <code class="docutils literal notranslate"><span class="pre">*</span></code>. This means that
these
functions can have nested formulas, since they keep evaluating
all the way down.</p>
<p>There are some new pseudocode symbols here that we need
to translate into English. We already know <code class="docutils literal notranslate"><span class="pre">+</span></code>:
“increment the
value after this”. Now we also see:</p>
<p><code class="docutils literal notranslate"><span class="pre">?</span></code>: “check whether the
value after this is a cell. Return
0 if yes, 1 if no”.4</p>
<p><code class="docutils literal notranslate"><span class="pre">=</span></code>: “ﬁrst run the function
in <code class="docutils literal notranslate"><span class="pre">b</span></code> with subject <code class="docutils literal notranslate"><span class="pre">a</span></code> as the
argument, and same for the function in <code class="docutils literal notranslate"><span class="pre">c</span></code>.
If the
results are equal, return 0, if not, return 1.</p>
<section id="example-not-a-cell">
<h4>2.7.1  Example: Not a Cell<a class="headerlink" href="#example-not-a-cell" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 50
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[3 0 1]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[50 [3 0 1]] 
?*[50 [0 1]] 
::get memory slot 1 of the subject 
?(50) 
:: is 50 a cell? No, so return 1 
1
</pre></div>
</div>
</section>
<section id="example-a-cell">
<h4>2.7.2  Example: A Cell<a class="headerlink" href="#example-a-cell" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[3 0 1]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[[50 51] [3 0 1]] 
?*[[50 51] [0 1]] 
::get memory slot 1 of the subject: [50 51] 
?([50 51]) 
:: is [50 51] a cell? Yes, so return 0 
0
</pre></div>
</div>
</section>
<section id="example-nested-cell-evaluation-with-4">
<h4>2.7.3  Example: Nested Cell Evaluation with <code class="docutils literal notranslate"><span class="pre">4</span></code><a class="headerlink" href="#example-nested-cell-evaluation-with-4" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 4 3 0 1]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[[50 51] [4 4 3 0 1]] 
+*[[50 51] [4 3 0 1]] 
:: whatever comes out of the 3 function, 
:: we&#39;re gonna increment it twice 
++*[[50 51] [3 0 1]] 
:: down to just fetching memory slot 1 
++?*[[50 51] [0 1]] 
++?([50 51]) 
:: is [50 51] a cell? Yes, so return 0 
++(0) 
+(1) 
2
</pre></div>
</div>
</section>
<section id="example-check-multiple-cases-of-cells">
<h4>2.7.4  Example: Check Multiple Cases of Cells<a class="headerlink" href="#example-check-multiple-cases-of-cells" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [[50 51] 52]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[[3 0 2] [3 0 3]]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[[[50 51] 52] [[3 0 2] [3 0 3]]] 
?[*[[50 51] 52] [0 2]] 
  *[[50 51] [0 3]]] 
:: yank memory slots 2 and 3 
?*[[50 51] 52] 
:: first is a cell, second is not 
[0 1]
</pre></div>
</div>
</section>
<section id="example-equality-test">
<h4>2.7.5  Example: Equality Test<a class="headerlink" href="#example-equality-test" title="Link to this heading">#</a></h4>
<p>Because <code class="docutils literal notranslate"><span class="pre">5</span></code> compares the
results of 2 formulas, it always makes
2 inner evaluations of the subject. It’s similar to Cell-Maker in
this way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[5 [0 2] [0 2]]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">factor</span> <span class="n">out</span> <span class="n">the</span> <span class="o">=</span> 
<span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">get</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">2</span> <span class="n">twice</span> 
<span class="o">=</span><span class="p">(</span><span class="mi">50</span> <span class="mi">50</span><span class="p">)</span> 
<span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="example-comparing-two-unequal-values">
<h4>2.7.6  Example: Comparing Two Unequal Values<a class="headerlink" href="#example-comparing-two-unequal-values" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[5 [0 2] [0 3]]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">factor</span> <span class="n">out</span> <span class="n">the</span> <span class="o">=</span> 
<span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">get</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">3</span> 
<span class="o">=</span><span class="p">(</span><span class="mi">50</span> <span class="mi">51</span><span class="p">)</span> 
<span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="example-compare-values-with-function-calls">
<h4>2.7.7  Example: Compare Values with Function Calls<a class="headerlink" href="#example-compare-values-with-function-calls" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[5 [4 0 2] [0 3]]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">factor</span> <span class="n">out</span> <span class="n">the</span> <span class="o">=</span> 
<span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
   <span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">factor</span> <span class="n">out</span> <span class="n">the</span> <span class="o">+</span> 
<span class="o">=</span><span class="p">[</span><span class="o">+*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
   <span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">get</span> <span class="n">memory</span> <span class="n">slots</span> <span class="mi">2</span> <span class="ow">and</span> <span class="mi">3</span> 
<span class="o">=</span><span class="p">[</span><span class="o">+</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">evaluate</span> <span class="n">the</span> <span class="o">+</span> 
<span class="o">=</span><span class="p">([</span><span class="mi">51</span> <span class="mi">51</span><span class="p">])</span> 
<span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="example-compare-cells-with-function-calls">
<h4>2.7.8  Example: Compare Cells with Function Calls<a class="headerlink" href="#example-compare-cells-with-function-calls" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [99 99]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[5 [1 [99 99]] [0 1]]
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]]</span> 
<span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="p">[[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]]]</span> 
  <span class="o">*</span><span class="p">[[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">first</span> <span class="n">cell</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">result</span> <span class="n">of</span> <span class="n">quoter</span> <span class="n">function</span> 
<span class="p">::</span> <span class="n">second</span> <span class="n">cell</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">result</span> <span class="n">of</span> <span class="n">memory</span> <span class="n">fetch</span> 
<span class="o">=</span><span class="p">[[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]</span> <span class="p">[</span><span class="mi">99</span> <span class="mi">99</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">true</span> 
<span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="summary-of-3-and-5">
<h4>2.7.9  Summary of <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code><a class="headerlink" href="#summary-of-3-and-5" title="Link to this heading">#</a></h4>
<p>These along with <code class="docutils literal notranslate"><span class="pre">4</span></code> are known as the
“axiomatic” functions.
They exist to implement deﬁnitional logic for the Nock
speciﬁcation. In particular, the cell check and the equality
check provide for structural analysis of nouns.</p>
</section>
</section>
<section id="the-subject-altering-function">
<h3>2.8  <code class="docutils literal notranslate"><span class="pre">2</span></code>, the “Subject-Altering” Function<a class="headerlink" href="#the-subject-altering-function" title="Link to this heading">#</a></h3>
<p>In all our examples so far, the subject has been deﬁned at the
start when we call the interpreter, and never changes. But
what if we want to change the subject?</p>
<p>A diﬀerent subject? Why would we want that? Here’s an
easy example. Say you found the following piece of Nock code
on the interwebz:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">8</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span> <span class="mi">8</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">6</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">7</span><span class="p">]</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="mi">9</span> <span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> 
            <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">7</span><span class="p">]</span> <span class="mi">9</span> <span class="mi">2</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>This is the code for a Nock function that expects a subject
that is an atom, and decrements that subject by 1. You can
actually enter it in the Dojo right now:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(100 [8 [1 0] 8 [1 6 [5 [0 7] 4 0 6] [0 6] 9 2 [0 2] [4 0 6] 0 7] 9 2 0 1])
</pre></div>
</div>
</div>
</div>
<p>This works! You do not have to understand the code right
now; just try entering diﬀerent numbers instead of <code class="docutils literal notranslate"><span class="pre">100</span></code> to see
the program working.</p>
<p>But now imagine that I have a Nock program with a
diﬀerent subject</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">.*</span><span class="p">([</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="n">some</span><span class="o">-</span><span class="n">formula</span><span class="p">)</span>
</pre></div>
</div>
<p>And somewhere inside <code class="docutils literal notranslate"><span class="pre">some-formula</span></code>, I want to
decrement the number <code class="docutils literal notranslate"><span class="pre">51</span></code>. I can’t pass <code class="docutils literal notranslate"><span class="pre">[50</span> <span class="pre">51]</span></code>
as the
subject to my decrementer code above though, because that’s
a cell, and it expects just an atom (a number).</p>
</section>
<section id="subject-altering-to-the-rescue">
<h3>2.8.1  Subject Altering to the Rescue<a class="headerlink" href="#subject-altering-to-the-rescue" title="Link to this heading">#</a></h3>
<p>The function/opcode <code class="docutils literal notranslate"><span class="pre">2</span></code> is designed to
handle this problem for
us. First the pseudocode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">2</span> <span class="n">b</span> <span class="n">c</span><span class="p">]</span>  <span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">c</span><span class="p">]]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">2</span></code>
expects 2 formulas after the subject <code class="docutils literal notranslate"><span class="pre">a</span></code>: <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code>. With
those, it:</p>
<p>runs formula <code class="docutils literal notranslate"><span class="pre">b</span></code> against
the subject to set up a new
environment/subject derived from the subject</p>
<p>runs formula <code class="docutils literal notranslate"><span class="pre">c</span></code> against
the subject to prepare a 2nd
function</p>
<p>run that 2nd function against the new
environment/subject from step (1)</p>
<p>Note that the pseudocode for <code class="docutils literal notranslate"><span class="pre">2</span></code> has nested <code class="docutils literal notranslate"><span class="pre">*</span></code>s.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">c</span><span class="p">]]</span>
</pre></div>
</div>
<p>The two inner <code class="docutils literal notranslate"><span class="pre">*</span></code>s run steps (1)
and (2), and the outer one,
around the whole expression, runs step (3).</p>
<section id="example-change-the-subject-and-call-a-constant-value">
<h4>2.8.2  Example: Change the Subject and Call a Constant Value<a class="headerlink" href="#example-change-the-subject-and-call-a-constant-value" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([50 51] [2 [0 3] [1 [4 0 1]]]) 
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[[50 51] [2 [0 3] [1 [4 0 1]]]] 
:: separate b and c to each run against the subject (steps 1 and 2) 
*[*[[50 51] [0 3]] *[[50 51] [1 [4 0 1]]]] 
:: after steps 1 and 2, we have a new subject, 51! 
:: note how we&#39;re back in normal *[subject formula] form 
*[51 [4 0 1]] 
:: apply the 4 function as we&#39;re used to 
+*[51 [0 1]] 
:: grab 51 from memory slot 1 
+(51) 
52
</pre></div>
</div>
</section>
<section id="example-grab-a-block-of-code-from-the-subject-and-run-it">
<h4>2.8.3  Example: Grab a Block of Code from the Subject and Run It<a class="headerlink" href="#example-grab-a-block-of-code-from-the-subject-and-run-it" title="Link to this heading">#</a></h4>
<p>Think of this as grabbing a “stored procedure” from the
subject.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([[4 0 1] 51] [2 [0 3] [0 2]])
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[[[4 0 1] 51] [2 [0 3] [0 2]]] 
*[*[[[4 0 1] 51] [0 3] 
  *[[[4 0 1] 51] [0 2]]]] 
:: step 1 gets memory slot 3, step 2 grabs memory slot 2 
*[51 [4 0 1]] 
:: looks like a normal 4 opcode to me! 
+*[51 [0 1]] 
:: grab memory slot 1 
+(51) 
52
</pre></div>
</div>
</section>
<section id="example-back-to-our-motivating-case">
<h4>2.8.4  Example: Back to Our Motivating Case<a class="headerlink" href="#example-back-to-our-motivating-case" title="Link to this heading">#</a></h4>
<p>Remember our decrementing block of code that we couldn’t
use when the subject was <code class="docutils literal notranslate"><span class="pre">[50</span> <span class="pre">51]</span></code>,
instead of just an
atom? Opcode <code class="docutils literal notranslate"><span class="pre">2</span></code>
makes handling that issue a piece of
cake.</p>
<p>We simply use <code class="docutils literal notranslate"><span class="pre">2</span></code> to transform our
subject into an atom,
and use <code class="docutils literal notranslate"><span class="pre">1</span></code> to
quote the decrement block of code before it
evaluates in step (3).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([50 51] [2 [0 2] [1 [8 [1 0] 8 [1 6 [5 [0 7] 4 0 6] [0 6] 9 2 [0 2] [4 0 6] 0 7] 9 2 0 1]]]) 
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span> <span class="p">(</span><span class="s2">&quot;decrement-formula&quot;</span> <span class="n">substituted</span> <span class="k">for</span> <span class="n">clarity</span><span class="p">)</span> 
<span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="n">decrement</span><span class="o">-</span><span class="n">formula</span><span class="p">]]]</span> 
<span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">*</span><span class="p">[[</span><span class="mi">50</span> <span class="mi">51</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="n">decrement</span><span class="o">-</span><span class="n">formula</span><span class="p">]]]</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="n">decrement</span><span class="o">-</span><span class="n">formula</span><span class="p">]</span> 
<span class="p">::</span><span class="n">decrement</span><span class="o">-</span><span class="n">formula</span> <span class="n">has</span> <span class="n">the</span> <span class="n">atom</span> <span class="n">subject</span> <span class="n">that</span> <span class="n">it</span> <span class="n">wants</span> 
<span class="mi">49</span>
</pre></div>
</div>
</section>
<section id="summary-of-2">
<h4>2.8.5  Summary of <code class="docutils literal notranslate"><span class="pre">2</span></code><a class="headerlink" href="#summary-of-2" title="Link to this heading">#</a></h4>
<p>For those who know a bit of Hoon, the second example above
is rather similar to calling an arm that produces a gate, and
then running the gate. Most of Hoon runs this type of
stored-procedure plus subject-altering Nock, and it all uses
opcode <code class="docutils literal notranslate"><span class="pre">2</span></code> at its
base.</p>
<p>And for those who know Hoon, <code class="docutils literal notranslate"><span class="pre">[[4</span> <span class="pre">0</span> <span class="pre">1]</span> <span class="pre">51]</span></code>
should
already be looking a lot like <code class="docutils literal notranslate"><span class="pre">[battery</span> <span class="pre">payload]</span></code>…
that’s
not a coincidence. We’re starting to see the ﬁrst glimpses of
how Hoon’s cores, arms and subjects/subject mutations ﬂow</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  out of the fundamental structure of Nock.
</pre></div>
</div>
<p>We also see how Hoon/Nock lend themselves well to
throwing around chunks of code, and adjusting the subject as
necessary to create the correct subject/environment against
which to run that code.</p>
</section>
</section>
<section id="summary-of-fundamental-opcodes">
<h3>2.9  Summary of Fundamental Opcodes<a class="headerlink" href="#summary-of-fundamental-opcodes" title="Link to this heading">#</a></h3>
<p>You now have seen all the fundamental functions/opcodes in
Nock. In the next part, I’ll introduce the remaining functions,
which no longer need pseudocode: we have enough scaﬀolding
now to build the rest of Nock from Nock itself. Instead, these
new opcodes will just be shortcuts/macros/code expansions
building on opcodes <code class="docutils literal notranslate"><span class="pre">0</span></code>–<code class="docutils literal notranslate"><span class="pre">5</span></code>.</p>
<p>We’ll also start to connect Nock to Hoon, and see how
most of the fundamental (and slightly weird) features of Hoon
ﬂow directly from Nock’s structure, and make a lot more sense
in combination with it.</p>
</section>
</section>
<section id="composite-opcodes">
<h2>3  Composite Opcodes<a class="headerlink" href="#composite-opcodes" title="Link to this heading">#</a></h2>
<p>A word of encouragement: we’re done with the hard part now.
Every Nock function we learn in this section will be built from
pieces in the preceding section.</p>
<p>None of these new functions are necessary to make Nock
work. All of them except Nock <code class="docutils literal notranslate"><span class="pre">10</span></code> and <code class="docutils literal notranslate"><span class="pre">11</span></code> are syntactic
sugar
that is part of the Nock deﬁnition, and must be built into
every correct Nock implementation. If you have seen macros or
code expansions in other languages, that’s another word for
what’s happening here.</p>
<p>Nock <code class="docutils literal notranslate"><span class="pre">10</span></code> makes it easier
to replace a memory value
somewhere in a tree, and Nock <code class="docutils literal notranslate"><span class="pre">11</span></code> allows passing
hints to the
interpreter.</p>
<p>One point of clarity: this syntactic sugar/code-expansion
system is not extensible. This means that you can’t invent
your own Nock opcodes and still have that language be Nock;
you’re making a higher-level language on top of Nock at that
point.</p>
<p>In fact, that’s not a bad way to think of Hoon: it’s a
higher-level language that adds missing syntatic sugar/macros
and human-readable names to Nock. (That’s not the whole
story, but it’s a decent mental peg to initially hang Hoon
on.)</p>
<p>Nock is intentionally very, very small, such that you can
always walk through and analyze what is happening in a block
of code if you know Nock’s opcodes.</p>
<section id="an-aside-about-the-1-quoter-function">
<h3>3.1  An Aside About the <code class="docutils literal notranslate"><span class="pre">1</span></code> (Quoter Function)<a class="headerlink" href="#an-aside-about-the-1-quoter-function" title="Link to this heading">#</a></h3>
<p>You’re going to see the <code class="docutils literal notranslate"><span class="pre">1</span></code> opcode (the
“Quoter”) appear in a
lot of examples below for a simple reason: the <code class="docutils literal notranslate"><span class="pre">6</span></code>-<code class="docutils literal notranslate"><span class="pre">9</span></code> opcodes
expect formulas in a lot of places, not just atoms. And, as
we’ve seen already, formulas have to be cells.</p>
<p>Whenever a formula is required, but you really just want
to return a number, you use the quoter function.</p>
<section id="example-incrementing-a-constant">
<h4>3.1.1  Example: Incrementing a Constant<a class="headerlink" href="#example-incrementing-a-constant" title="Link to this heading">#</a></h4>
<p>We just want to run <code class="docutils literal notranslate"><span class="pre">4</span></code> on the number 5, but <code class="docutils literal notranslate"><span class="pre">4</span></code> expects a formula after it, so we use <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">5]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[4 1 5]
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-comparing-a-memory-slot-to-a-constant-value">
<h4>3.1.2  Example: Comparing a Memory Slot to a Constant Value<a class="headerlink" href="#example-comparing-a-memory-slot-to-a-constant-value" title="Link to this heading">#</a></h4>
<p>We grab memory slot 2, then it has to be compared to the result of a formula, so we just use the formula <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">23]</span></code> to return 23.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([23 45] [5 [0 2] [1 23]]) 
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="if-else-conditional-branch">
<h3>3.2  <code class="docutils literal notranslate"><span class="pre">6</span></code>, “If/Else” Conditional Branch<a class="headerlink" href="#if-else-conditional-branch" title="Link to this heading">#</a></h3>
<p>The remaining Nock opcodes are “sugar”. This means that the
functions in this next part will use only <code class="docutils literal notranslate"><span class="pre">*</span></code> and
Nock code in
their pseudocode. For example, here is the code for <code class="docutils literal notranslate"><span class="pre">6</span></code>, the
“If/Else” function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">6</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span><span class="p">]</span>     <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="o">*</span><span class="p">[[</span><span class="n">c</span> <span class="n">d</span><span class="p">]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">4</span> <span class="mi">4</span> <span class="n">b</span><span class="p">]]]]</span>
</pre></div>
</div>
<p>The prose explanation of what’s happening is
straightforward:</p>
<p>Evaluate <code class="docutils literal notranslate"><span class="pre">b</span></code> against the
subject <code class="docutils literal notranslate"><span class="pre">a</span></code> (<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>)
to see
whether it’s <code class="docutils literal notranslate"><span class="pre">0</span></code>/true or <code class="docutils literal notranslate"><span class="pre">1</span></code>/false.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">b</span></code> equals <code class="docutils literal notranslate"><span class="pre">0</span></code>/true, run formula <code class="docutils literal notranslate"><span class="pre">c</span></code> against subject <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">b</span></code> equals <code class="docutils literal notranslate"><span class="pre">1</span></code>/false, run formula <code class="docutils literal notranslate"><span class="pre">d</span></code> against subject <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">b</span></code> is not equal to
<code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>, the code crashes, for
reasons we’ll see in the code explanation.</p>
<p>3.2.1  Code Explanation (Way
More Fun)</p>
<p>OK, so that’s the English version. The code explanation (the
right side of the deﬁnition) is really fun now that we know the
basic Nock opcodes.</p>
<p>The pseudocode has four nested <code class="docutils literal notranslate"><span class="pre">*[subject</span> <span class="pre">formula]</span></code>s,
so I’m going to unwrap those to the bottom, and then build it
up again. The layers are, in order:</p>
<p><code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">...]</span></code>,
i.e. subject <code class="docutils literal notranslate"><span class="pre">a</span></code> evaluated against that long
formula starting with <code class="docutils literal notranslate"><span class="pre">*[[c</span> <span class="pre">d]</span> <span class="pre">0</span> <span class="pre">...]</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">*[c</span> <span class="pre">d]</span></code>,
i.e. subject <code class="docutils literal notranslate"><span class="pre">c</span></code> evaluated against the
formula
starting with <code class="docutils literal notranslate"><span class="pre">[[2</span> <span class="pre">3</span> <span class="pre">...]</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">*[2</span> <span class="pre">3]</span></code>,
i.e. subject <code class="docutils literal notranslate"><span class="pre">2</span></code> evaluated against the
lowest-level formula.</p>
<p>Finally, subject <code class="docutils literal notranslate"><span class="pre">a</span></code>
evaluated against formula
<code class="docutils literal notranslate"><span class="pre">[4</span> <span class="pre">4</span> <span class="pre">b]</span></code>.</p>
<section id="step-4">
<h4>3.2.2  Step 4<a class="headerlink" href="#step-4" title="Link to this heading">#</a></h4>
<p>Remember, our English explanation was “see if <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
is
true or false, and do diﬀerent actions depending on that. Step
Four is that check.”</p>
<p>Let’s say we have <code class="docutils literal notranslate"><span class="pre">a</span></code> as <code class="docutils literal notranslate"><span class="pre">59</span></code>, and <code class="docutils literal notranslate"><span class="pre">b</span></code> as the quoted value
<code class="docutils literal notranslate"><span class="pre">0</span></code>/true.</p>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">4</span> <span class="mi">4</span> <span class="n">b</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">a</span><span class="p">:</span> <span class="mi">59</span> 
<span class="p">::</span> <span class="n">b</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">59</span> <span class="mi">4</span> <span class="mi">4</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">substitute</span> <span class="n">out</span> <span class="n">the</span> <span class="n">two</span> <span class="n">increment</span> <span class="n">operators</span> 
<span class="o">++*</span><span class="p">[</span><span class="mi">59</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">ignore</span> <span class="n">subject</span><span class="p">,</span> <span class="k">return</span> <span class="n">quoted</span> <span class="n">value</span> <span class="mi">0</span> 
<span class="o">++</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
<span class="mi">2</span>
</pre></div>
</div>
<p>In summary, because <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
evaluated to <code class="docutils literal notranslate"><span class="pre">0</span></code>/true, we get
the number <code class="docutils literal notranslate"><span class="pre">2</span></code>. If <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
had been <code class="docutils literal notranslate"><span class="pre">1</span></code>/false,
we’d get <code class="docutils literal notranslate"><span class="pre">3</span></code>
(because we’d evaluate <code class="docutils literal notranslate"><span class="pre">++(1)</span></code>).</p>
<p>What the heck? Why are we getting <code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">3</span></code> back? How
does that help us?? Well, Nock uses that returned <code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">3</span></code> as
a memory slot, and executes the code in that memory
slot.</p>
</section>
<section id="step-3">
<h4>3.2.3  Step 3<a class="headerlink" href="#step-3" title="Link to this heading">#</a></h4>
<p>Now we go up to step 3, with the subject <code class="docutils literal notranslate"><span class="pre">[2</span> <span class="pre">3]</span></code>
evaluated
against our return value from step 4. Let’s imagine that <code class="docutils literal notranslate"><span class="pre">2</span></code> had
been returned:</p>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span> <span class="n">remember</span><span class="p">,</span> <span class="s2">&quot;result-of-step-4&quot;</span> <span class="n">was</span> <span class="mi">2</span> 
<span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="n">result</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">step</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> 
<span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">get</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">2</span> 
<span class="mi">2</span>
</pre></div>
</div>
<p>This grabs memory slot <code class="docutils literal notranslate"><span class="pre">2</span></code> if
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
was true, and
memory slot <code class="docutils literal notranslate"><span class="pre">3</span></code> if <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
was false.</p>
<p>Wait, isn’t this redundant? We are just using our <code class="docutils literal notranslate"><span class="pre">2</span></code>
or <code class="docutils literal notranslate"><span class="pre">3</span></code> generated in step 4 to generate a <code class="docutils literal notranslate"><span class="pre">2</span></code> or a <code class="docutils literal notranslate"><span class="pre">3</span></code>. Seems
dumb.</p>
<p>The answer is that we make sure that a crash happens if
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
yields any answer other than <code class="docutils literal notranslate"><span class="pre">0</span></code>/true or <code class="docutils literal notranslate"><span class="pre">1</span></code>/false. If
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
returned <code class="docutils literal notranslate"><span class="pre">10</span></code>, for example, we’d have the
following
code in step 3:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*[[2 3] 0 10] 
:: there&#39;s no slot 10 
CRASH!!
</pre></div>
</div>
<p>This is exactly what we want: the program crashes unless we are doing
a loobean
test that returns a <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code> (converted to an indicial <code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">3</span></code>) in
step 4.  (A loobean is a boolean truth value but with the typical truth values of 0 and 1 reversed to 0/true and 1/false.)</p>
</section>
<section id="step-2">
<h4>3.2.4  Step 2<a class="headerlink" href="#step-2" title="Link to this heading">#</a></h4>
<p>We now have our validated <code class="docutils literal notranslate"><span class="pre">2</span></code> or
<code class="docutils literal notranslate"><span class="pre">3</span></code> to plug into step 2.
Let’s imagine <code class="docutils literal notranslate"><span class="pre">c</span></code> is the simple formula <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>
and <code class="docutils literal notranslate"><span class="pre">d</span></code> is
<code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">203]</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span> <span class="k">if</span> <span class="n">step</span> <span class="mi">3</span> <span class="n">returned</span> <span class="s2">&quot;2&quot;</span> <span class="p">(</span><span class="n">true</span><span class="p">)</span> 
<span class="o">*</span><span class="p">[[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">203</span><span class="p">]]</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> 
<span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Not much to see here: we just grab memory slot <code class="docutils literal notranslate"><span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">3</span></code>
depending on whether our initial <code class="docutils literal notranslate"><span class="pre">b</span></code> was true or
false.</p>
</section>
<section id="step-1">
<h4>3.2.5  Step 1<a class="headerlink" href="#step-1" title="Link to this heading">#</a></h4>
<p>And now we’re back at the top level, where we just use
whichever formula we yoinked in step 2 and run it against
<code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">formula</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">step</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">let</span><span class="s1">&#39;s say we returned formula [0 1] </span>
<span class="p">::</span> <span class="n">our</span> <span class="n">original</span> <span class="n">a</span><span class="p">,</span> <span class="kn">from</span><span class="w"> </span><span class="nn">step</span> <span class="mi">4</span><span class="p">,</span> <span class="n">was</span> <span class="mi">59</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">59</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> 
<span class="mi">59</span>
</pre></div>
</div>
</section>
<section id="example-code-expansion-of-6">
<h4>3.2.6  Example: Code Expansion of <code class="docutils literal notranslate"><span class="pre">6</span></code><a class="headerlink" href="#example-code-expansion-of-6" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(1 [6 [0 1] [0 1] [4 0 1]]) 
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="o">*</span><span class="p">[[</span><span class="n">c</span> <span class="n">d</span><span class="p">]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">4</span> <span class="mi">4</span> <span class="n">b</span><span class="p">]]]]</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="o">*</span><span class="p">[[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">4</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]]]]</span> 
<span class="p">::</span> <span class="n">factor</span> <span class="n">out</span> <span class="n">the</span> <span class="mi">4</span> <span class="n">opcodes</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="o">*</span><span class="p">[[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="o">++*</span><span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]]]]</span> 
<span class="p">::</span> <span class="n">b</span> <span class="n">evaluates</span> <span class="n">to</span> <span class="mi">1</span> <span class="p">(</span><span class="n">yank</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">1</span><span class="p">)</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="o">*</span><span class="p">[[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="o">++</span><span class="p">(</span><span class="mi">1</span><span class="p">)]]]</span> 
<span class="p">::</span> <span class="n">evaluate</span> <span class="n">the</span> <span class="n">two</span> <span class="n">increments</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="o">*</span><span class="p">[[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="mi">0</span> <span class="o">*</span><span class="p">[[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]]]</span> 
<span class="p">::</span> <span class="n">get</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">3</span> <span class="kn">from</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="o">*</span><span class="p">[[[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]]</span> 
<span class="p">::</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="n">means</span> <span class="n">get</span> <span class="n">memory</span> <span class="n">slot</span> <span class="mi">3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">the</span> <span class="n">subject</span> <span class="p">(</span><span class="n">formula</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">])</span> 
<span class="o">*</span><span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">factor</span> <span class="n">out</span> <span class="n">the</span> <span class="mi">4</span> <span class="n">opcode</span> 
<span class="o">+*</span><span class="p">[</span><span class="mi">1</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="summary-of-6">
<h4>3.2.7  Summary of <code class="docutils literal notranslate"><span class="pre">6</span></code><a class="headerlink" href="#summary-of-6" title="Link to this heading">#</a></h4>
<p>Now I’m going to make you a little sad. Most Nock interpreters
don’t do this whole awesome code expansion. They just see <code class="docutils literal notranslate"><span class="pre">6</span></code>,
and implement an if/else check with a crash if <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>
isn’t a
loobean.</p>
<p>However, the pattern of storing chunks of code in memory
and pulling them out when you want them is the most
important part of Nock. In fact, those of you who know Hoon
are probably already seeing the makings of the “core” code
pattern.</p>
</section>
</section>
<section id="the-composition-opcode">
<h3>3.3  <code class="docutils literal notranslate"><span class="pre">7</span></code>, the “Composition” Opcode<a class="headerlink" href="#the-composition-opcode" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">7</span></code> is so simple we
barely need to spend time on it. All it does is
create a new subject/environment (using <code class="docutils literal notranslate"><span class="pre">2</span></code>), and immediately
runs a formula against that new subject. Let’s compare it to
<code class="docutils literal notranslate"><span class="pre">2</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span><span class="n">opcode</span> <span class="mi">7</span> 
<span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">7</span> <span class="n">b</span> <span class="n">c</span><span class="p">]</span>  <span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]</span> <span class="n">c</span><span class="p">]</span> 
 
<span class="p">::</span> <span class="n">opcode</span> <span class="mi">2</span> 
<span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">2</span> <span class="n">b</span> <span class="n">c</span><span class="p">]</span>  <span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">c</span><span class="p">]]</span>
</pre></div>
</div>
<p>This is almost exactly the same except with <code class="docutils literal notranslate"><span class="pre">c</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>.
This means that you can write a “subject-changing”
formula in <code class="docutils literal notranslate"><span class="pre">b</span></code>, and then run a simple function
against that in
<code class="docutils literal notranslate"><span class="pre">c</span></code>.</p>
<section id="example-opcode-2-vs-opcode-7">
<h4>3.3.1  Example: Opcode <code class="docutils literal notranslate"><span class="pre">2</span></code> vs. Opcode <code class="docutils literal notranslate"><span class="pre">7</span></code><a class="headerlink" href="#example-opcode-2-vs-opcode-7" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([23 45] [2 [0 3] [1 4 0 1]]) 
</pre></div>
</div>
</div>
</div>
<p>Using opcode <code class="docutils literal notranslate"><span class="pre">7</span></code>, we get to remove the quoter opcode <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([23 45] [7 [0 3] [4 0 1]]) 
</pre></div>
</div>
</div>
</div>
<p>Opcode <code class="docutils literal notranslate"><span class="pre">7</span></code> is clearly
trivial, so why does it exist? It allows
clean expression of function composition: this is really
<code class="docutils literal notranslate"><span class="pre">c(b(a))</span></code>,
where <code class="docutils literal notranslate"><span class="pre">a</span></code> (the subject) is the initial argument,
and <code class="docutils literal notranslate"><span class="pre">b</span></code>
and <code class="docutils literal notranslate"><span class="pre">c</span></code> are functions. This pattern comes up a
ton, and it’s nice
to not use <code class="docutils literal notranslate"><span class="pre">1</span></code>s
everywhere.</p>
</section>
</section>
<section id="the-variable-push-opcode">
<h3>3.4  <code class="docutils literal notranslate"><span class="pre">8</span></code>, the “Variable Push” Opcode<a class="headerlink" href="#the-variable-push-opcode" title="Link to this heading">#</a></h3>
<p>If you’re ever writing Nock and think “how can I add a new
variable to the subject?”, opcode <code class="docutils literal notranslate"><span class="pre">8</span></code> is what you want.
The new
variable can be based on either the existing subject, or be a
new value you add on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">8</span> <span class="n">b</span> <span class="n">c</span><span class="p">]</span>          <span class="o">*</span><span class="p">[[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">b</span><span class="p">]</span> <span class="n">a</span><span class="p">]</span> <span class="n">c</span><span class="p">]</span>
</pre></div>
</div>
<p>This says to run <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">b]</span></code>,
and then make that the head of
a new subject, with the old subject <code class="docutils literal notranslate"><span class="pre">a</span></code> as the new
subject’s
tail.</p>
<section id="example-add-variable-as-a-copied-value-from-an-existing-subject">
<h4>3.4.1  Example: Add Variable as a Copied Value from an Existing Subject<a class="headerlink" href="#example-add-variable-as-a-copied-value-from-an-existing-subject" title="Link to this heading">#</a></h4>
<p>In English, the below code ﬁrst yanks the variable from
memory slot 3, copies it to the head of a new subject, and
then increments the value in that new head.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([67 39] [8 [0 3] [4 0 2]])
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="o">*</span><span class="p">[[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">3</span><span class="p">]]</span> <span class="p">[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">yanks</span> <span class="n">mem</span> <span class="n">slot</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">pins</span> <span class="n">it</span> <span class="n">to</span> <span class="n">the</span> <span class="n">front</span> <span class="n">of</span> <span class="n">the</span> <span class="n">old</span> <span class="n">subject</span> 
<span class="o">*</span><span class="p">[[</span><span class="mi">39</span> <span class="p">[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="o">+*</span><span class="p">[[</span><span class="mi">39</span> <span class="p">[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">39</span><span class="p">)</span> 
<span class="mi">40</span>
</pre></div>
</div>
</section>
<section id="example-add-variable-as-a-new-value">
<h4>3.4.2  Example: Add Variable as a New Value<a class="headerlink" href="#example-add-variable-as-a-new-value" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([67 39] [8 [1 0] [4 0 2]])
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[[</span><span class="o">*</span><span class="p">[[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]]</span> <span class="p">[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="o">*</span><span class="p">[[</span><span class="mi">0</span> <span class="p">[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="o">+*</span><span class="p">[[</span><span class="mi">0</span> <span class="p">[</span><span class="mi">67</span> <span class="mi">39</span><span class="p">]]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
<span class="mi">1</span>
</pre></div>
</div>
<p>Why do we want this? In the ﬁrst example, we pin a copy of a
value so that we can manipulate it without changing the
original. In the second example, we add a <code class="docutils literal notranslate"><span class="pre">0</span></code> to the front;
maybe we want to increment it until some condition is
met?</p>
<p>The above should be starting to feel very Hoon-ish: we’re a
minor code transform away from pinning new values to the
head of a payload.</p>
</section>
</section>
<section id="run-a-stored-procedure-arm-in-a-core">
<h3>3.5  <code class="docutils literal notranslate"><span class="pre">9</span></code>, Run a Stored Procedure Arm in a Core<a class="headerlink" href="#run-a-stored-procedure-arm-in-a-core" title="Link to this heading">#</a></h3>
<p>We’re almost at full Hoon now, although still at a very
low/raw level. <code class="docutils literal notranslate"><span class="pre">9</span></code>
looks a little complicated…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">9</span> <span class="n">b</span> <span class="n">c</span><span class="p">]</span>  <span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">c</span><span class="p">]</span> <span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="n">b</span><span class="p">]</span>
</pre></div>
</div>
<p>… but in English, this is just saying:</p>
<ol class="arabic simple">
<li><p>Use formula <code class="docutils literal notranslate"><span class="pre">c</span></code> to make a
new subject from <code class="docutils literal notranslate"><span class="pre">a</span></code>
(<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>).</p></li>
<li><p>Grab the formula located at memory slot <code class="docutils literal notranslate"><span class="pre">b</span></code> in that
new subject.</p></li>
<li><p>Run that formula against the new subject <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>.</p></li>
</ol>
<p>The fact that the above description has the words “make a
new subject” tells us right away that it’s syntactic sugar for
opcode <code class="docutils literal notranslate"><span class="pre">2</span></code>, and
that’s indeed what we see in the pseudocode.</p>
<section id="example-using-9-to-run-an-increment-arm">
<h4>3.5.1  Example: Using <code class="docutils literal notranslate"><span class="pre">9</span></code> to Run an Increment Arm<a class="headerlink" href="#example-using-9-to-run-an-increment-arm" title="Link to this heading">#</a></h4>
<p>The initial expression here likely looks cryptic, but if you
follow the pseudocode, it will become clear.</p>
<p>To stay oriented, remember that, if we’re thinking of <code class="docutils literal notranslate"><span class="pre">9</span></code> as
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">9</span> <span class="pre">b</span> <span class="pre">c]</span></code>,
then</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="mi">45</span> 
<span class="n">b</span><span class="p">:</span> <span class="mi">2</span> 
<span class="n">c</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(45 [9 2 [1 4 0 3] 0 1])
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">45</span> <span class="p">[</span><span class="mi">9</span> <span class="mi">2</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]]</span> 
<span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="mi">45</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">new</span> <span class="n">subject</span> <span class="ow">is</span> <span class="p">[[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">45</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">formula</span> <span class="n">to</span> <span class="n">increment</span> <span class="n">mem</span> <span class="n">slot</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">the</span> 
<span class="p">::</span> <span class="n">head</span><span class="p">;</span> <span class="mi">45</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">tail</span> 
<span class="o">*</span><span class="p">[[[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">45</span><span class="p">]</span> <span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">now</span> <span class="n">we</span> <span class="n">expand</span> <span class="n">opcode</span> <span class="mi">2</span> 
<span class="o">*</span><span class="p">[</span><span class="o">*</span><span class="p">[[[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">45</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> 
  <span class="o">*</span><span class="p">[[[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">45</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]]</span> 
<span class="p">::</span> <span class="n">mem</span> <span class="n">slot</span> <span class="mi">2</span> <span class="n">of</span> <span class="n">the</span> <span class="n">subject</span> <span class="n">becomes</span> <span class="n">the</span> <span class="n">new</span> <span class="n">formula</span> 
<span class="o">*</span><span class="p">[[[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">45</span><span class="p">]</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> 
<span class="o">+*</span><span class="p">[[[</span><span class="mi">4</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> <span class="mi">45</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span> 
<span class="p">::</span> <span class="n">grab</span> <span class="n">mem</span> <span class="n">slot</span> <span class="mi">3</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> 
<span class="mi">46</span>
</pre></div>
</div>
<p>We start above with a subject that is not a core; it’s just
the atom <code class="docutils literal notranslate"><span class="pre">45</span></code>. The code for <code class="docutils literal notranslate"><span class="pre">c</span></code> is then:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[[1 4 0 3] [0 1]]
</pre></div>
</div>
</div>
</div>
<p>This formula uses the Cell Maker (Distribution Rule) to
insert <code class="docutils literal notranslate"><span class="pre">[4</span> <span class="pre">0</span> <span class="pre">3]</span></code>
as the head of the new subject, and puts mem
slot <code class="docutils literal notranslate"><span class="pre">1</span></code> of the old subject as the tail, so we get
a new subject of
<code class="docutils literal notranslate"><span class="pre">[[4</span> <span class="pre">0</span> <span class="pre">3]</span> <span class="pre">45]</span></code>.</p>
<p>What we do next is use <code class="docutils literal notranslate"><span class="pre">b</span></code> (here,
<code class="docutils literal notranslate"><span class="pre">2</span></code>) to select memory slot <code class="docutils literal notranslate"><span class="pre">2</span></code>
from that new subject. Memory slot <code class="docutils literal notranslate"><span class="pre">2</span></code> is a
formula: <code class="docutils literal notranslate"><span class="pre">[4</span> <span class="pre">0</span> <span class="pre">3]</span></code>.
We run that formula against the new subject.</p>
</section>
<section id="key-point-possible-confusion">
<h4>3.5.2  Key Point/Possible Confusion<a class="headerlink" href="#key-point-possible-confusion" title="Link to this heading">#</a></h4>
<p>When I ﬁrst saw <code class="docutils literal notranslate"><span class="pre">9</span></code>, I thought: “why
didn’t they just use <code class="docutils literal notranslate"><span class="pre">2</span></code> to
make the transformed subject? Why is there an extra step to
use <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>
to pull the new <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>
subject? Why can’t we do
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">2</span> <span class="pre">c</span> <span class="pre">[0</span> <span class="pre">b]]</span></code>?</p>
<p>The answer is that we actually use the <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>
subject
twice:</p>
<p>We extract from it the formula located at memory
slot <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>Then we run that formula against the <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>
subject.</p>
<p>If we just did <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">2</span> <span class="pre">c</span> <span class="pre">[0</span> <span class="pre">b]]</span></code>,
then <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">b]</span></code>
would try
to look up the <code class="docutils literal notranslate"><span class="pre">b</span></code> memory slot in <code class="docutils literal notranslate"><span class="pre">a</span></code>, not <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>.
So <code class="docutils literal notranslate"><span class="pre">9</span></code> gives us
one extra step to set up the core itself.</p>
</section>
<section id="how-to-think-of-9">
<h4>3.5.3  How to Think of <code class="docutils literal notranslate"><span class="pre">9</span></code><a class="headerlink" href="#how-to-think-of-9" title="Link to this heading">#</a></h4>
<p>I like to think of <code class="docutils literal notranslate"><span class="pre">9</span></code> as having three
parts:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code>: our formula to set up
the subject, making a new
subject.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b</span></code>: the memory slot in our
new subject where an arm
is.</p></li>
<li><p>Run the arm located at <code class="docutils literal notranslate"><span class="pre">b</span></code>
against the new subject.</p></li>
</ul>
<p>You can think of this as setting up a subject, pulling a stored
procedure from it, and then running that procedure against
the subject.</p>
</section>
</section>
<section id="replace-a-memory-slot">
<h3>3.6  <code class="docutils literal notranslate"><span class="pre">10</span></code>, Replace a Memory Slot<a class="headerlink" href="#replace-a-memory-slot" title="Link to this heading">#</a></h3>
<p>Before explaining <code class="docutils literal notranslate"><span class="pre">10</span></code>, we need to
introduce a new operator, <code class="docutils literal notranslate"><span class="pre">#</span></code>
hax. <code class="docutils literal notranslate"><span class="pre">#</span></code> hax is the “edit” operator. It has
the form</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#[mem-slot new-val target-tree]</span>
</pre></div>
</div>
<p>It replaces the memory slot <code class="docutils literal notranslate"><span class="pre">mem-slot</span></code> in <code class="docutils literal notranslate"><span class="pre">target-tree</span></code> with
<code class="docutils literal notranslate"><span class="pre">new-val</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span>  <span class="n">Example</span> 
<span class="c1">#[2 [4 5] [99 88 77]] </span>
<span class="p">[[</span><span class="mi">4</span> <span class="mi">5</span><span class="p">]</span> <span class="mi">88</span> <span class="mi">77</span><span class="p">]</span>
</pre></div>
</div>
<p>The pseudocode for <code class="docutils literal notranslate"><span class="pre">10</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">10</span> <span class="p">[</span><span class="n">b</span> <span class="n">c</span><span class="p">]</span> <span class="n">d</span><span class="p">]</span>  <span class="c1">#[b *[a c] *[a d]]</span>
</pre></div>
</div>
<p>In English, this ﬁrst calculates <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>
and <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">d]</span></code>,
and
then replaces memory slot <code class="docutils literal notranslate"><span class="pre">b</span></code> in the latter with
the result of the
former.</p>
<section id="example-using-10-to-replace-a-memory-slot">
<h4>3.6.1  Example: Using <code class="docutils literal notranslate"><span class="pre">10</span></code> to Replace a Memory Slot<a class="headerlink" href="#example-using-10-to-replace-a-memory-slot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(50 [10 [2 [0 1]] [1 8 9 10]]) 
</pre></div>
</div>
</div>
</div>
<p>PSEUDOCODE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">10</span> <span class="p">[</span><span class="mi">2</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">]]]</span> 
<span class="c1">#[2 *[50 0 1] *[50 1 8 9 10]] </span>
<span class="c1">#[2 /[1 50] [8 9 10]] </span>
<span class="c1">#[2 50 [8 9 10]] </span>
<span class="p">::</span>  <span class="n">expanded</span> <span class="k">as</span> <span class="n">far</span> <span class="k">as</span> <span class="n">we</span> <span class="n">can</span><span class="p">,</span> <span class="n">now</span> <span class="n">do</span> <span class="n">the</span> <span class="n">edit</span> 
<span class="p">::</span>  <span class="n">replace</span> <span class="n">mem</span> <span class="n">slot</span> <span class="mi">2</span> <span class="n">of</span> <span class="p">[</span><span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">]</span> <span class="k">with</span> <span class="n">the</span> <span class="n">value</span> <span class="mi">50</span> 
<span class="p">[</span><span class="mi">50</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>We will defer discussion of opcode <code class="docutils literal notranslate"><span class="pre">11</span></code> to a later
section
because it is not part of strict Nock semantics.</p>
</section>
<section id="towards-hoon">
<h4>3.6.2  Towards Hoon<a class="headerlink" href="#towards-hoon" title="Link to this heading">#</a></h4>
<p>If “grab a chunk of code from a subject and then run it
against the subject” sounds a lot like getting an arm from
a core in Hoon, that’s because it is. Nock opcode <code class="docutils literal notranslate"><span class="pre">9</span></code> is
hand-in-glove with Hoon’s core/arm structure. The “new
subjects” created by <code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">c]</span></code>
are cores, and the things selected
from memory slots by <code class="docutils literal notranslate"><span class="pre">b</span></code> are arms.</p>
</section>
</section>
<section id="real-nock-code">
<h3>3.7  Real Nock Code<a class="headerlink" href="#real-nock-code" title="Link to this heading">#</a></h3>
<p>To ﬁnish this oﬀ and take your new powers for a spin, let’s
look at some real Nock code from the wild. I got the below
example from the Dojo. It’s a mold: a function that takes a
noun and returns it if it’s the correct type, and crashes if not.
The mold here checks whether the input noun is a loobean
(<code class="docutils literal notranslate"><span class="pre">0</span></code>/true or <code class="docutils literal notranslate"><span class="pre">1</span></code>/false).</p>
<section id="example-a-loobean-mold">
<h4>3.7.1  Example: A Loobean Mold<a class="headerlink" href="#example-a-loobean-mold" title="Link to this heading">#</a></h4>
<p>(This example is intended to illustrate Hoon type gates or <em>molds</em>, which are not supplied with the Nock Jupyter kernel and are thus not executable here.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>:: loobean mold gate 
&gt; =loobean-mold ? 
 
:: below output truncated for our purposes here 
5&gt; loobean-mold 
&lt; 1.fxf ... &gt; 
 
::  grab the code for the battery 
&gt; -.loobean-mold 
10[8 [6 [5 [1 0] 0 6] [1 0] 6 [5 [1 1] 0 6] [1 1] 0 0] 
 8 [5 [0 14] 0 2] 0 6]
</pre></div>
</div>
<p>So we:</p>
<ol class="arabic simple">
<li><p>Assign the mold gate denoted by <code class="docutils literal notranslate"><span class="pre">?</span></code> to the face
<code class="docutils literal notranslate"><span class="pre">loobean-mold</span></code>.</p></li>
<li><p>Examine what’s inside, seeing that the head is an
arm.</p></li>
<li><p>Print out that source code by calling the head.</p></li>
</ol>
<p>The below code acts as a formula which evaluates its sample,
and returns it if it’s a loobean or crashes otherwise. Let’s see
how that works.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">6</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span> <span class="mi">6</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>We start with <code class="docutils literal notranslate"><span class="pre">6</span></code>, which means this
is an if-else. The true/false
test is the next element:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">0</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
<p>This compares the quoted value <code class="docutils literal notranslate"><span class="pre">0</span></code> (from <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">0]</span></code>)
with the
value at memory slot <code class="docutils literal notranslate"><span class="pre">6</span></code> in the subject (<code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">6]</span></code>).</p>
<p>What is the subject and what is at mem slot <code class="docutils literal notranslate"><span class="pre">6</span></code>? This code
is the arm of a gate, so the subject is that gate/core:
<code class="docutils literal notranslate"><span class="pre">[battery</span> <span class="pre">[sample</span> <span class="pre">payload]]</span></code>.
We are looking at the
battery right now, and so <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">6]</span></code>
yanks the head of the tail, or
the <code class="docutils literal notranslate"><span class="pre">sample</span></code>!</p>
<p>We know the sample will be a noun that we’re testing for
loobeanness, so this code starts by seeing whether the sample
is the value <code class="docutils literal notranslate"><span class="pre">0</span></code>/true. If it is, the next element
is <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">0]</span></code>,
so we
return <code class="docutils literal notranslate"><span class="pre">0</span></code> if the sample is <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>Otherwise, we run the second branch of the <code class="docutils literal notranslate"><span class="pre">if</span></code>–<code class="docutils literal notranslate"><span class="pre">else</span></code>
conditional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">6</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>This is also an opcode <code class="docutils literal notranslate"><span class="pre">6</span></code> if-else. Once
again, it compares
something to the value at mem slot <code class="docutils literal notranslate"><span class="pre">6</span></code> (the
sample), but this
time it checks whether that is the value <code class="docutils literal notranslate"><span class="pre">1</span></code>. If
it is, it runs the
formula <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">1]</span></code>
to return <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>If not, it means our input was neither <code class="docutils literal notranslate"><span class="pre">0</span></code> nor <code class="docutils literal notranslate"><span class="pre">1</span></code>
and is not a loobean, so we run the formula <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">0]</span></code>,
which always crashes (as there is no memory slot
<code class="docutils literal notranslate"><span class="pre">0</span></code>).  (Recall that in the binary tree addressing scheme of Nock, 1 refers to the entire noun, 2 to its head if it exists, and 3 to its tail if it exists.)
This is exactly what we want—crash if the sample is not a
loobean!</p>
<p>The second part of the formula which is composed with an
<code class="docutils literal notranslate"><span class="pre">8</span></code> is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">8</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">14</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">]</span> <span class="mi">0</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
<p>This checks whether the battery of the current gate is
equivalent to the head of the context; if so, it returns the
sample. This is a artifact of a type promotion in Hoon which
converts a bare loobean value to a constant by pinning a
constant as an example ﬁrst (i.e., at slot 14). (It’s completely
extraneous in Nock itself, however.)</p>
</section>
</section>
<section id="summary">
<h3>3.8  Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h3>
<p>In this section, we’ve seen how to use almost all of the
remaining opcodes, which build Nock up to a slightly more
expressive level. We also saw how Hoon cores start to arise
pretty naturally out of the Nock primitives, especially <code class="docutils literal notranslate"><span class="pre">8</span></code> and
<code class="docutils literal notranslate"><span class="pre">9</span></code>. Then we walked
through real production Nock code to show
that everything we’ve learned so far works exactly as expected
in the wild. In the next section, you’ll learn how to write real
programs in Nock, and compose those programs to make new
ones. Finally, hopefully you now see that, whatever its other
limitations, Nock is not particularly obscurantist, and is fairly
straightforward to parse, once you understand its syntax and
idioms.</p>
</section>
</section>
<section id="interlude">
<h2>4  Interlude<a class="headerlink" href="#interlude" title="Link to this heading">#</a></h2>
<p>In this section, we cover some loose ends deriving from the
previous discussion.</p>
<section id="order-of-operations">
<h3>4.1  Order of Operations<a class="headerlink" href="#order-of-operations" title="Link to this heading">#</a></h3>
<p>At this point, we can answer the question of what order Nock
evaluates expressions in. The answer is straightforward: it
starts with code that has only one pseudocode operator and
all Nock code, as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="mi">4</span> <span class="mi">4</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]]]</span>
</pre></div>
</div>
<p>The interpreter can then be thought of as moving left-to-right,
expanding according to its rules, until it can’t expand any
further into pseudocode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="mi">4</span> <span class="mi">4</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]]]</span> 
<span class="o">+*</span><span class="p">[</span><span class="mi">50</span> <span class="mi">4</span> <span class="p">[</span><span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]]]</span> 
<span class="o">++*</span><span class="p">[</span><span class="mi">50</span> <span class="mi">5</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]]</span> 
<span class="o">++=</span><span class="p">[</span><span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">*</span><span class="p">[</span><span class="mi">50</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]]]</span> 
<span class="o">++=</span><span class="p">[</span><span class="o">/</span><span class="p">[</span><span class="mi">1</span> <span class="mi">50</span><span class="p">]</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
<p>Once we get to that last line, <code class="docutils literal notranslate"><span class="pre">++=[/[1</span> <span class="pre">50]</span> <span class="pre">*[50</span> <span class="pre">[1</span> <span class="pre">50]]]</span></code>,
no further expansion into pseudocode is possible.</p>
<p>At this point, the interpreter expands “inside-out”, starting
from the deepest operators. In this case, those are <code class="docutils literal notranslate"><span class="pre">/[1</span> <span class="pre">50]</span></code>
and <code class="docutils literal notranslate"><span class="pre">50</span></code>, so it does those:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">++=</span><span class="p">[</span><span class="mi">50</span> <span class="mi">50</span><span class="p">]</span>
</pre></div>
</div>
<p>Then it moves to the next-furthest-inside operator: <code class="docutils literal notranslate"><span class="pre">=</span></code>, and
then to the <code class="docutils literal notranslate"><span class="pre">+</span></code> operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">++=</span><span class="p">[</span><span class="mi">50</span> <span class="mi">50</span><span class="p">]</span> 
<span class="o">++</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> 
<span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<span class="mi">2</span>
</pre></div>
</div>
<section id="summary-of-nock-order-of-operations">
<h4>4.1.1  Summary of Nock Order of Operations<a class="headerlink" href="#summary-of-nock-order-of-operations" title="Link to this heading">#</a></h4>
<p>On the ﬁrst pass, when we have
Nock code <code class="docutils literal notranslate"><span class="pre">*(nock-code)</span></code>,
we expand left-to-right
into pseudocode.</p>
<p>On the second pass, when we’ve fully expanded
pseudocode, we evaluate operators from the
inside-out.</p>
</section>
</section>
<section id="hints-and-side-effects-for-the-interpreter">
<h3>4.2  <code class="docutils literal notranslate"><span class="pre">11</span></code>, Hints and Side Eﬀects for the Interpreter<a class="headerlink" href="#hints-and-side-effects-for-the-interpreter" title="Link to this heading">#</a></h3>
<p>Opcode <code class="docutils literal notranslate"><span class="pre">11</span></code> lets you compute
side eﬀects and pass information
to Nock’s interpreter, for that interpreter to do what it wants.
The most common uses are things like jets and debugging
prints. In theory, this opcode is fairly dangerous, since it tells
the interpreter that it’s free to do anything.</p>
<p>There are two diﬀerent versions of <code class="docutils literal notranslate"><span class="pre">11</span></code>, depending on
whether the head following <code class="docutils literal notranslate"><span class="pre">11</span></code> is an atom or a
cell</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">::</span>  <span class="n">head</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">atom</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> 
<span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">11</span> <span class="n">b</span> <span class="n">c</span><span class="p">]</span>  <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">c</span><span class="p">]</span> 
 
<span class="p">::</span>  <span class="n">head</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">cell</span> <span class="p">([</span><span class="n">b</span> <span class="n">c</span><span class="p">])</span> 
<span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="mi">11</span> <span class="p">[</span><span class="n">b</span> <span class="n">c</span><span class="p">]</span> <span class="n">d</span><span class="p">]</span>     <span class="o">*</span><span class="p">[[</span><span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">c</span><span class="p">]</span> <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="n">d</span><span class="p">]]</span> <span class="mi">0</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>This pseudocode lets <code class="docutils literal notranslate"><span class="pre">11</span></code> handle two
separate use
cases:</p>
<p>We just want the interpreter to process a message in
its own language/environment.</p>
<p>We want the interpreter to compute some Nock code
with Nock semantics before processing the hint.</p>
<section id="option-1-interpreter-processes-a-message">
<h4>4.2.1  Option #1: Interpreter Processes a Message<a class="headerlink" href="#option-1-interpreter-processes-a-message" title="Link to this heading">#</a></h4>
<p>Imagine the following Nock:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([50 51] [11 369 0 2])
</pre></div>
</div>
</div>
</div>
<p>This passes the value <code class="docutils literal notranslate"><span class="pre">369</span></code> to
the interpreter, where maybe it
would be the key in a hashmap. The value associated with the
could be the function to debug print the whole operation. Or
the value could be a jet function that speciﬁcally knows how
to compute the <code class="docutils literal notranslate"><span class="pre">0</span></code>
opcode faster when it’s followed by a
<code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<p>After the interpreter does whatever, it needs to then
discard the value <code class="docutils literal notranslate"><span class="pre">292.989</span></code>, and
computes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([50 51] [0 2]) 
</pre></div>
</div>
</div>
</div>
<p>(In practice, the Nock Jupyter kernel does not support any special side effects from <code class="docutils literal notranslate"><span class="pre">11</span></code> commands.)</p>
</section>
<section id="option-2-run-nock-code-and-then-process-a-message">
<h4>4.2.2  Option #2: Run Nock Code and then Process a Message<a class="headerlink" href="#option-2-run-nock-code-and-then-process-a-message" title="Link to this heading">#</a></h4>
<p>In this case, instead of passing a static value to the interpreter,
we pass it a Nock computation against the subject. The result
of that computation will then be available to the interpreter to
use as a message.</p>
</section>
<section id="practical-use-of-11-jet-registration">
<h4>4.2.3  Practical Use of <code class="docutils literal notranslate"><span class="pre">11</span></code>: Jet Registration<a class="headerlink" href="#practical-use-of-11-jet-registration" title="Link to this heading">#</a></h4>
<p>Jet registration in Hoon usually looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">++</span>  <span class="n">my</span><span class="o">-</span><span class="n">function</span> 
  <span class="o">~/</span>  <span class="o">%</span><span class="n">my</span><span class="o">-</span><span class="n">function</span> 
  <span class="o">|=</span>  <span class="n">var</span><span class="o">=*</span> 
  <span class="o">...</span>
</pre></div>
</div>
<p>The Hoon rune <code class="docutils literal notranslate"><span class="pre">~/</span></code> fassig uses
Nock <code class="docutils literal notranslate"><span class="pre">11</span></code> to pass
the value
<code class="docutils literal notranslate"><span class="pre">%my-function</span></code> to the interpreter, where it is
associated with
the C code that produces the product of <code class="docutils literal notranslate"><span class="pre">my-function</span></code>.</p>
</section>
</section>
<section id="nock-in-hoon">
<h3>4.3  Nock in Hoon<a class="headerlink" href="#nock-in-hoon" title="Link to this heading">#</a></h3>
<p>In Hoon, you can acquire the Nock code for any function by
using the <code class="docutils literal notranslate"><span class="pre">!=</span></code> zaptis rune. Since this produces
Nock code
complete with gate calls, you may also ﬁnd it helpful to cast a
data type as a noun using <code class="docutils literal notranslate"><span class="pre">^-</span>&#160; <span class="pre">*</span></code>,
which will show you the
raw Nock code for that value.</p>
<p>As you have seen, you can also evaluate raw Nock using
the <code class="docutils literal notranslate"><span class="pre">.*</span></code> dottar rune, which evaluates to Nock
opcode <code class="docutils literal notranslate"><span class="pre">2</span></code>. Other
Nock runes in Hoon include <code class="docutils literal notranslate"><span class="pre">.+</span></code> dotlus, which is
opcode <code class="docutils literal notranslate"><span class="pre">4</span></code>; <code class="docutils literal notranslate"><span class="pre">.=</span></code>
dottis, which is opcode <code class="docutils literal notranslate"><span class="pre">5</span></code>; and <code class="docutils literal notranslate"><span class="pre">.?</span></code> dotwut, which is opcode <code class="docutils literal notranslate"><span class="pre">3</span></code>.
Fake opcode <code class="docutils literal notranslate"><span class="pre">12</span></code> is
not actually Nock, but is used in a
virtualization context to resolve values that may not be
available in the current subject.</p>
</section>
</section>
<section id="the-core-as-design-pattern">
<h2>5  The Core as Design Pattern<a class="headerlink" href="#the-core-as-design-pattern" title="Link to this heading">#</a></h2>
<p>At this point, you now know everything there is to know
about Nock syntax and basic code manipulation. However, if I
asked you to go write a simple program in Nock, you’d
probably have a hard time getting started. It’s really helpful
to see some examples of how Nock programs are designed and
patterns that tend to recur in them.</p>
<p>We can set variables to formulas in the interface. We will
use that in this lesson to make code easy to follow, and
to show how Nock programs are made out of discrete
chunks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:increment [4 0 1]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(50 increment) 
</pre></div>
</div>
</div>
</div>
<section id="building-a-core-manually">
<h3>5.1  Building a Core Manually<a class="headerlink" href="#building-a-core-manually" title="Link to this heading">#</a></h3>
<p>Every Nock program is just a formula that takes in a subject
(argument). In order to run full programs against a subject,
we follow the following pattern:</p>
<p>First pass: set up the dominos inside an opcode like
<code class="docutils literal notranslate"><span class="pre">2</span></code> (or <code class="docutils literal notranslate"><span class="pre">7</span></code>/<code class="docutils literal notranslate"><span class="pre">8</span></code>/<code class="docutils literal notranslate"><span class="pre">9</span></code>). This will
create a core, and evaluate it
on the second pass.</p>
<p>Second pass: evaluate that core to get our result.</p>
<p>The pseudocode for opcode <code class="docutils literal notranslate"><span class="pre">2</span></code>, this looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">[</span><span class="n">subject</span> <span class="mi">2</span> <span class="n">core</span><span class="o">-</span><span class="n">formula</span> <span class="n">call</span><span class="o">-</span><span class="n">formula</span><span class="p">]</span>
</pre></div>
</div>
<p>Almost always, however, we’ll use the <code class="docutils literal notranslate"><span class="pre">9</span></code> opcode (which is
sugar on top of <code class="docutils literal notranslate"><span class="pre">2</span></code>) to actually start
our programs running,
since it supports the concept of “cores” and “arms” very
naturally. (For those who know Hoon, this “set up a
core and run it” pattern should feel similar to <code class="docutils literal notranslate"><span class="pre">|^</span></code> or
<code class="docutils literal notranslate"><span class="pre">=&gt;</span></code>.)</p>
<section id="example-a-simple-increment-gate">
<h4>5.1.1  Example: A Simple Increment Gate<a class="headerlink" href="#example-a-simple-increment-gate" title="Link to this heading">#</a></h4>
<p>Let’s take code to increment the subject and turn it into a
Hoon-style gate (a core with one arm and a sample). The code
itself is simple: <code class="docutils literal notranslate"><span class="pre">[4</span> <span class="pre">0</span> <span class="pre">1]</span></code>.</p>
<p>Our code expects the subject to be an atom, but Hoon
gates expect their subject to be the gate itself, which has the
form <code class="docutils literal notranslate"><span class="pre">[battery</span> <span class="pre">payload]</span></code>.
So we need to adjust our
formula to accept this subject format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:inc [7 [0 3] [4 0 1]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([1 74] inc)
</pre></div>
</div>
</div>
</div>
<p>We put our formula in the head, and put a default
(“bunted”) sample of <code class="docutils literal notranslate"><span class="pre">0</span></code> as the payload.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:incgate [inc 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:show incgate
</pre></div>
</div>
</div>
</div>
<p>Arms are best invoked using the <code class="docutils literal notranslate"><span class="pre">9</span></code> opcode. Here we
use the
“standard” version of it: <code class="docutils literal notranslate"><span class="pre">[9</span> <span class="pre">2</span> <span class="pre">0</span> <span class="pre">1]</span></code>.
Recall that <code class="docutils literal notranslate"><span class="pre">9</span></code> is
<code class="docutils literal notranslate"><span class="pre">*[a</span> <span class="pre">9</span> <span class="pre">b</span> <span class="pre">c]</span></code>,
where <code class="docutils literal notranslate"><span class="pre">c</span></code> is the “new subject” formula, and
<code class="docutils literal notranslate"><span class="pre">b</span></code>
is the memory slot of that new subject to take an arm
from. Here we use <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">1]</span></code>
to keep our subject (the gate)
unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(incgate [9 2 0 1])
</pre></div>
</div>
</div>
</div>
<p>To “pass a parameter” to our gate, we use the <code class="docutils literal notranslate"><span class="pre">10</span></code>
opcode to edit the subject (the <code class="docutils literal notranslate"><span class="pre">inc-gate</span></code> core)
and
replace the payload with a value. We make our subject
<code class="docutils literal notranslate"><span class="pre">[inc-gate</span> <span class="pre">val-to-increment]</span></code>.</p>
<p>Notice how opcode <code class="docutils literal notranslate"><span class="pre">10</span></code> can replace the last element of <code class="docutils literal notranslate"><span class="pre">incgate</span></code>; the tail of <code class="docutils literal notranslate"><span class="pre">incgate</span></code> was 0; now it’s 36.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([incgate 36] [10 [3 [0 3]] 0 2])
</pre></div>
</div>
</div>
</div>
<p>Now use that to set up the subject with a new tail (sample) and call arm in memory slot 2 (our increment formula).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([incgate 36] [9 2 10 [3 [0 3]] 0 2])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([incgate 562] [9 2 10 [3 [0 3]] 0 2])
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h4>5.1.2  Summary<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>What was the point of this? We took a perfectly good
increment formula that worked on atoms, and made it more
complicated for the same result. Lame!</p>
<p>In fact, however, this setup will come in really handy
when we have multiple arms in our core, not just one.
We’ve made it easy to set up a clean environment for
increment to ﬁnd its sample in, no matter what other data is
present. This will come in very handy in our third example
program.</p>
<p>First, however, let’s look at putting a more complicated
formula inside a gate. (Hint: the process is the same).</p>
</section>
<section id="example-a-decrement-gate">
<h4>5.1.3  Example: A Decrement Gate<a class="headerlink" href="#example-a-decrement-gate" title="Link to this heading">#</a></h4>
<p>Here we take a piece of code that decrements the subject when
the subject is an atom, and turn it into a gate. For now, we
will take it as a given that the decrement function given below
works. (The code will crash when the input is a cell or
<code class="docutils literal notranslate"><span class="pre">0</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:dec [6 [5 [0 1] [1 0]] [0 0] [6 [3 0 1] [0 0] [8 [1 0] 8 [1 6 [5 [0 7] 4 0 6] [0 6] 9 2 [0 2] [4 0 6] 0 7] 9 2 0 1]]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(100 dec)
</pre></div>
</div>
</div>
</div>
<p>Expect crash on non-atom input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([100 101] dec) 
</pre></div>
</div>
</div>
</div>
<p>Let’s re-jigger the decrement formula to accept the subject
in format <code class="docutils literal notranslate"><span class="pre">[battery</span> <span class="pre">payload]</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:decarm [7 [0 3] dec]
</pre></div>
</div>
</div>
</div>
<p>Verify that <code class="docutils literal notranslate"><span class="pre">decarm</span></code> decrements the value in the tail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([1 88] decarm)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:show decarm
</pre></div>
</div>
</div>
</div>
<p>Next, assemble the core.  All we need to do is add the sample, with default value of 0:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:decgate [decarm 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:show dec-gate
</pre></div>
</div>
</div>
</div>
<p>As in the ﬁrst example, we use the <code class="docutils literal notranslate"><span class="pre">10</span></code> opcode to edit
the
subject (the <code class="docutils literal notranslate"><span class="pre">dec-gate</span></code> core) and replace the
payload with a
value. We make our subject <code class="docutils literal notranslate"><span class="pre">[dec-gate</span> <span class="pre">val-to-decrement]</span></code>.</p>
<p>Confirm that our <code class="docutils literal notranslate"><span class="pre">10</span></code> code places 36 in the tail:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([decgate 36] [10 [3 [0 3]] 0 2]) 
</pre></div>
</div>
</div>
</div>
<p>Now use that to set up the subject with a new tail (sample) and call the arm in memory slot 2 (our decrement formula):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([decgate 36] [9 2 10 [3 [0 3]] 0 2])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([decgate 562] [9 2 10 [3 [0 3]] 0 2])
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-comparing-two-numbers">
<h4>5.1.4  Example: Comparing Two Numbers<a class="headerlink" href="#example-comparing-two-numbers" title="Link to this heading">#</a></h4>
<p>In this example we will build a Nock core that compares two
numbers and returns whether they are greater than, less than,
or equal to each other.</p>
<p>The program speciﬁcation is to take two numbers <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>
and return:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> if <code class="docutils literal notranslate"><span class="pre">a==b</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> if <code class="docutils literal notranslate"><span class="pre">a&gt;b</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code> if <code class="docutils literal notranslate"><span class="pre">a&lt;b</span></code>.</p></li>
</ul>
<p>The trick is that the only mathematical operators we have
for this are the <code class="docutils literal notranslate"><span class="pre">4</span></code> opcode for
increment, <code class="docutils literal notranslate"><span class="pre">5</span></code> for
equals, and a
decrement Nock function that we will supply. The basic
algorithm is:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">a==b</span></code>, return <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">a==0</span></code>, return <code class="docutils literal notranslate"><span class="pre">2</span></code>. (I.e, <code class="docutils literal notranslate"><span class="pre">a&lt;b</span></code>).</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">b==0</span></code>, return <code class="docutils literal notranslate"><span class="pre">1</span></code>. (I.e., <code class="docutils literal notranslate"><span class="pre">a&gt;b</span></code>).</p></li>
</ul>
<p>Recur with <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> both decremented.</p>
<p>The above works because if <code class="docutils literal notranslate"><span class="pre">a</span></code> is
smaller than <code class="docutils literal notranslate"><span class="pre">b</span></code>, it hits 0
ﬁrst. If <code class="docutils literal notranslate"><span class="pre">b</span></code> is smaller than a, it hits <code class="docutils literal notranslate"><span class="pre">0</span></code> ﬁrst. If they are equal, we
never decrement in the ﬁrst place, so there are no issues with
numbers going negative.</p>
<p>We will construct a core that has two arms: one arm with
the algorithm logic, and a second arm with the decrement gate
from the second example. These arms will live in the head of
the core (think “battery”).</p>
<p>We will put our variables <code class="docutils literal notranslate"><span class="pre">a</span></code> and
<code class="docutils literal notranslate"><span class="pre">b</span></code> in the tail of the core
(think “payload”). They will be updated before the core is
called each time. (This is similar to a trap or door in
Hoon).</p>
<p>The ﬁnal core we will create will have the structure
<code class="docutils literal notranslate"><span class="pre">[battery</span> <span class="pre">payload]</span></code>,
which can be broken down as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">main</span><span class="o">-</span><span class="n">logic</span> <span class="n">dec</span><span class="o">-</span><span class="n">gate</span><span class="p">]</span> <span class="n">a</span> <span class="n">b</span><span class="p">]</span>
</pre></div>
</div>
<p>Once the core is set up, we’ll invoke the algorithm
logic arm to set it running. We will build the main logic
“inside-out”, by ﬁrst deﬁning the “recur” code, and then
inserting it into our if/else tests that implement the algorithm.</p>
<p>This recursion logic assumes the decrement gate lives in
the tail of the battery (the battery is the head), i.e. <code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">5]</span></code>.
We are using <code class="docutils literal notranslate"><span class="pre">[10</span> <span class="pre">[3</span> <span class="pre">[0</span> <span class="pre">memory-slot]]</span> <span class="pre">0</span> <span class="pre">5]</span></code>
to extract
the decrement gate from our core, and then we invoke it with
<code class="docutils literal notranslate"><span class="pre">[9</span> <span class="pre">2</span> <span class="pre">...]</span></code>.</p>
<p>This is identical to what we did in the second example—the
only diﬀerence is that we now do it twice: once for memory
slot <code class="docutils literal notranslate"><span class="pre">6</span></code> (<code class="docutils literal notranslate"><span class="pre">a</span></code>) and again for memory slot <code class="docutils literal notranslate"><span class="pre">7</span></code> (<code class="docutils literal notranslate"><span class="pre">b</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:deca [9 2 10 [3 [0 6]] 0 5]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:decb [9 2 10 [3 [0 7]] 0 5]
</pre></div>
</div>
</div>
</div>
<p>We can test our formulas by making a dummy core (a = 33, b = 77).  The first formula in the battery just returns the current subject.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:dummycore [[[0 1] decgate] 33 77]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(dummycore deca)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(dummycore decb)
</pre></div>
</div>
</div>
</div>
<p>The recursion formula here operates by invoking its
subject—itself—and applying the <code class="docutils literal notranslate"><span class="pre">dec-a</span></code> and <code class="docutils literal notranslate"><span class="pre">dec-b</span></code> formulas to
it. Then we use opcode <code class="docutils literal notranslate"><span class="pre">9</span></code> for the new
subject’s setup: replace
<code class="docutils literal notranslate"><span class="pre">payload</span></code> with new <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> run the current core</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:recur [9 4 [[0 2] deca decb]]
</pre></div>
</div>
</div>
</div>
<p>Test it—we want to see the same battery, with the payload being replaced with 32 and 76.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*(dummycore recur)
</pre></div>
</div>
</div>
</div>
<p>The main logic is then:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:mainlogic [6 [5 [0 6] [1 0]] [1 2] [6 [5 [0 7] [1 0]] [1 1] recur]]
</pre></div>
</div>
</div>
</div>
<p>Test (ignoring equality case):</p>
<p><span class="math notranslate nohighlight">\(a&lt;b\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([[mainlogic decgate] 9 10] [9 4 0 1])
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(a &gt; b\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([[mainlogic decgate] 10 9] [9 4 0 1]) 
</pre></div>
</div>
</div>
</div>
<p>We build an outer test for whether <code class="docutils literal notranslate"><span class="pre">a==b</span></code>, and then if it’s
not, we use the <code class="docutils literal notranslate"><span class="pre">1</span></code>
opcode to return the core.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:battery [mainlogic decgate]
</pre></div>
</div>
</div>
</div>
<p>The payload for the core is memory slots 2 and 3 (a and b):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:comparison [6 [5 [0 2] [0 3]] [1 0] [9 4 [[1 battery] [0 2] 0 3]]]
</pre></div>
</div>
</div>
</div>
<p>Test the three cases:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([0 8] comparison)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([0 0] comparison)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>.*([8 0] comparison)
</pre></div>
</div>
</div>
</div>
<p>We can take this code and use it anywhere that our subject
is a cell of two numbers, and it will “just work”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>:subject [50 51]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-nock notranslate"><div class="highlight"><pre><span></span>[6 [5 [0 2] 0 3] [1 0] 9 4 [1 [6 [5 [0 6] 1 0] [1 2] 6 [5 [0 7] 1 0] [1 1] 9 4 [0 2] [9 2 10 [3 0 6] 0 5] 9 2 10 [3 0 7] 0 5] [7 [0 3] 6 [5 [0 1] 1 0] [0 0] 6 [3 0 1] [0 0] 8 [1 0] 8 [1 6 [5 [0 7] 4 0 6] [0 6] 9 2 [0 2] [4 0 6] 0 7] 9 2 0 1] 0] [0 2] 0 3]
</pre></div>
</div>
</div>
</div>
<p>One common convention used in languages like Hoon is to
denote Nock rules as constants, e.g. <code class="docutils literal notranslate"><span class="pre">%0</span></code>
(corresponding
to our <code class="docutils literal notranslate"><span class="pre">0</span></code>). This
makes it much more straightforward to
interpret hand-rolled Nock code with addresses and constants
present.</p>
</section>
</section>
</section>
<section id="conclusion">
<h2>6  Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>After this tutorial, you should be prepared to interpret Nock
code when it is produced by Hoon. Although there is only
rarely any call to write Nock code directly, you should now
have a good understanding of how to read and interpret it. As
you write your own interpreters in the future, you may
even have call to hand-roll Nock expressions on occasion.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "nock"
        },
        kernelOptions: {
            name: "nock",
            path: "./content/examples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'nock'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tim-galebach-timluc-miptev-hyperware">Tim Galebach ~timluc-miptev / Hyperware</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contents">Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">1  Getting Started</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phases-of-nock">1.1  Phases of Nock</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-nock-interpreter">1.2  What Is a Nock Interpreter?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-run-nock-code">1.3  How to Run Nock Code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subject-formula">1.4  Subject, Formula?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamental-opcodes">2  Fundamental Opcodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nocks-simplest-functions-0-and-1">2.1  Nock’s Simplest Functions, <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-tree-addressing">2.2  Binary Tree Addressing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-memory-slot">2.3  <code class="docutils literal notranslate"><span class="pre">0</span></code>, the “Memory Slot”</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-retrieve-the-subject">2.3.1  Example: Retrieve the Subject</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-retrieve-the-head-of-the-subject">2.3.2  Example: Retrieve the Head of the Subject</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-crash">2.3.3  Example: A Crash</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-0">2.3.4  Summary of <code class="docutils literal notranslate"><span class="pre">0</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-quoter-function">2.4  <code class="docutils literal notranslate"><span class="pre">1</span></code>, the “Quoter” Function</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-1">2.4.1  Summary of <code class="docutils literal notranslate"><span class="pre">1</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-incrementing-function">2.5  <code class="docutils literal notranslate"><span class="pre">4</span></code>, the Incrementing Function</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-walking-through-increment">2.5.1  Example: Walking Through Increment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.5.2  Example: Walking Through Increment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-walking-through-serial-increment">2.5.3  Example: Walking Through Serial Increment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-walking-through-incrementing-a-constant">2.5.4  Example: Walking Through Incrementing a Constant</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-crash-when-incrementing-a-cell">2.5.5  Example: A Crash When Incrementing a Cell</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-4">2.5.6  Summary of <code class="docutils literal notranslate"><span class="pre">4</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cell-maker-aka-the-distribution-rule">2.6  The Cell-Maker (aka the Distribution Rule)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-detour-into-nock-formulas">2.6.1  A Quick Detour into Nock Formulas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cell-detector-and-5-the-equality-tester">2.7  <code class="docutils literal notranslate"><span class="pre">3</span></code>, the Cell Detector, and <code class="docutils literal notranslate"><span class="pre">5</span></code>, the Equality Tester</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-not-a-cell">2.7.1  Example: Not a Cell</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-cell">2.7.2  Example: A Cell</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-nested-cell-evaluation-with-4">2.7.3  Example: Nested Cell Evaluation with <code class="docutils literal notranslate"><span class="pre">4</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-check-multiple-cases-of-cells">2.7.4  Example: Check Multiple Cases of Cells</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-equality-test">2.7.5  Example: Equality Test</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-comparing-two-unequal-values">2.7.6  Example: Comparing Two Unequal Values</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-compare-values-with-function-calls">2.7.7  Example: Compare Values with Function Calls</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-compare-cells-with-function-calls">2.7.8  Example: Compare Cells with Function Calls</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-3-and-5">2.7.9  Summary of <code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">5</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-subject-altering-function">2.8  <code class="docutils literal notranslate"><span class="pre">2</span></code>, the “Subject-Altering” Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subject-altering-to-the-rescue">2.8.1  Subject Altering to the Rescue</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-change-the-subject-and-call-a-constant-value">2.8.2  Example: Change the Subject and Call a Constant Value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-grab-a-block-of-code-from-the-subject-and-run-it">2.8.3  Example: Grab a Block of Code from the Subject and Run It</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-back-to-our-motivating-case">2.8.4  Example: Back to Our Motivating Case</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-2">2.8.5  Summary of <code class="docutils literal notranslate"><span class="pre">2</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-fundamental-opcodes">2.9  Summary of Fundamental Opcodes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#composite-opcodes">3  Composite Opcodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-aside-about-the-1-quoter-function">3.1  An Aside About the <code class="docutils literal notranslate"><span class="pre">1</span></code> (Quoter Function)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-incrementing-a-constant">3.1.1  Example: Incrementing a Constant</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-comparing-a-memory-slot-to-a-constant-value">3.1.2  Example: Comparing a Memory Slot to a Constant Value</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-else-conditional-branch">3.2  <code class="docutils literal notranslate"><span class="pre">6</span></code>, “If/Else” Conditional Branch</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4">3.2.2  Step 4</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3">3.2.3  Step 3</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2">3.2.4  Step 2</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1">3.2.5  Step 1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-code-expansion-of-6">3.2.6  Example: Code Expansion of <code class="docutils literal notranslate"><span class="pre">6</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-6">3.2.7  Summary of <code class="docutils literal notranslate"><span class="pre">6</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-composition-opcode">3.3  <code class="docutils literal notranslate"><span class="pre">7</span></code>, the “Composition” Opcode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-opcode-2-vs-opcode-7">3.3.1  Example: Opcode <code class="docutils literal notranslate"><span class="pre">2</span></code> vs. Opcode <code class="docutils literal notranslate"><span class="pre">7</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-variable-push-opcode">3.4  <code class="docutils literal notranslate"><span class="pre">8</span></code>, the “Variable Push” Opcode</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-add-variable-as-a-copied-value-from-an-existing-subject">3.4.1  Example: Add Variable as a Copied Value from an Existing Subject</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-add-variable-as-a-new-value">3.4.2  Example: Add Variable as a New Value</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-a-stored-procedure-arm-in-a-core">3.5  <code class="docutils literal notranslate"><span class="pre">9</span></code>, Run a Stored Procedure Arm in a Core</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-using-9-to-run-an-increment-arm">3.5.1  Example: Using <code class="docutils literal notranslate"><span class="pre">9</span></code> to Run an Increment Arm</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#key-point-possible-confusion">3.5.2  Key Point/Possible Confusion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-think-of-9">3.5.3  How to Think of <code class="docutils literal notranslate"><span class="pre">9</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replace-a-memory-slot">3.6  <code class="docutils literal notranslate"><span class="pre">10</span></code>, Replace a Memory Slot</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-using-10-to-replace-a-memory-slot">3.6.1  Example: Using <code class="docutils literal notranslate"><span class="pre">10</span></code> to Replace a Memory Slot</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#towards-hoon">3.6.2  Towards Hoon</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-nock-code">3.7  Real Nock Code</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-loobean-mold">3.7.1  Example: A Loobean Mold</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">3.8  Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interlude">4  Interlude</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#order-of-operations">4.1  Order of Operations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-nock-order-of-operations">4.1.1  Summary of Nock Order of Operations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hints-and-side-effects-for-the-interpreter">4.2  <code class="docutils literal notranslate"><span class="pre">11</span></code>, Hints and Side Eﬀects for the Interpreter</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-1-interpreter-processes-a-message">4.2.1  Option #1: Interpreter Processes a Message</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#option-2-run-nock-code-and-then-process-a-message">4.2.2  Option #2: Run Nock Code and then Process a Message</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#practical-use-of-11-jet-registration">4.2.3  Practical Use of <code class="docutils literal notranslate"><span class="pre">11</span></code>: Jet Registration</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nock-in-hoon">4.3  Nock in Hoon</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-core-as-design-pattern">5  The Core as Design Pattern</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-core-manually">5.1  Building a Core Manually</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-simple-increment-gate">5.1.1  Example: A Simple Increment Gate</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">5.1.2  Summary</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-a-decrement-gate">5.1.3  Example: A Decrement Gate</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-comparing-two-numbers">5.1.4  Example: Comparing Two Numbers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">6  Conclusion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Urbit Systems Technical Journal
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>